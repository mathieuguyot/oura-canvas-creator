(this["webpackJsonpoura-canvas-creator"]=this["webpackJsonpoura-canvas-creator"]||[]).push([[0],{104:function(t,n,e){},217:function(t,n,e){"use strict";e.r(n);var o,i,r=e(0),a=e.n(r),c=e(17),s=e.n(c),u=(e(104),e(9)),l=e(12),p=e(42),d=e.n(p),v=e(16),h=e(11),f=e.n(h);function m(t,n){return t.x===n.x&&t.y===n.y}function y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=16*Math.random()|0;return("x"===t?n:3&n|8).toString(16)}))}!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT"}(o||(o={})),function(t){t[t.NO_PINS=0]="NO_PINS",t[t.LEFT_PIN=1]="LEFT_PIN",t[t.RIGHT_PIN=2]="RIGHT_PIN",t[t.BOTH_PINS=3]="BOTH_PINS"}(i||(i={}));var b=e(62),g=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),P=function(t){function n(n){var e=t.call(this,n)||this;return e.panStartPosition=null,e.shiftKey=!1,e.state={panDisabled:!1},e.onMouseDown=e.onMouseDown.bind(e),e.onMouseUp=e.onMouseUp.bind(e),e.onZoomChange=e.onZoomChange.bind(e),e.onPanning=e.onPanning.bind(e),e.onPanningStart=e.onPanningStart.bind(e),e.onPanningStop=e.onPanningStop.bind(e),e}return g(n,t),n.prototype.onMouseDown=function(t){this.shiftKey=t.shiftKey;var n=t.target,e=!1;"string"===typeof n.id&&(e="link_canvas"===n.id);var o=!1;"string"===typeof n.className&&(o=n.className.includes("react-transform-component")),this.setState({panDisabled:0!==t.button||!e&&!o})},n.prototype.onMouseUp=function(){this.setState({panDisabled:!1})},n.prototype.onZoomChange=function(t){(0,this.props.onPanZoomInfo)({zoom:t.scale,topLeftCorner:{x:t.positionX,y:t.positionY}})},n.prototype.onPanning=function(t){(0,this.props.onPanZoomInfo)({zoom:t.scale,topLeftCorner:{x:t.positionX,y:t.positionY}})},n.prototype.onPanningStart=function(t){this.panStartPosition={x:t.positionX,y:t.positionY}},n.prototype.onPanningStop=function(t){var n=this.props.onSelectItem,e={x:t.positionX,y:t.positionY};f.a.isEqual(this.panStartPosition,e)&&n(null,this.shiftKey)},n.prototype.render=function(){var t=this.props,n=t.panZoomInfo,e=t.children,o=this.state.panDisabled;return r.createElement("div",{id:"panzoom",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp},r.createElement(b.b,{options:{disabled:o,limitToBounds:!1,minScale:.35,centerContent:!1},pan:{velocity:!1},doubleClick:{disabled:!0},wheel:{step:100},onWheel:this.onZoomChange,onPanningStart:this.onPanningStart,onPanning:this.onPanning,onPanningStop:this.onPanningStop,scale:n.zoom,positionX:n.topLeftCorner.x,positionY:n.topLeftCorner.y,defaultScale:n.zoom,defaultPositionX:n.topLeftCorner.x,defaultPositionY:n.topLeftCorner.y},r.createElement(b.a,null,r.createElement("div",{style:{height:"100vh",width:"100vw"}},e))))},n}(r.Component);var O={theme:{node:{selected:{boxShadow:"0px 0px 0px 2px white",borderRadius:"10px 10px 10px 10px"},header:{backgroundColor:"orange",color:"white",borderRadius:"10px 10px 0px 0px",height:"20px",cursor:"grab",overflow:"hidden",paddingLeft:"10px"},body:{color:"white",backgroundColor:"rgba(63, 63, 63, 0.75)",cursor:"grab"},footer:{borderRadius:"0px 0px 10px 10px",height:"10px",backgroundColor:"rgba(63, 63, 63, 0.75)",cursor:"ew-resize"},basePin:{backgroundColor:"rgba(199, 199, 41, 1)",borderRadius:"5px 5px 5px 5px",cursor:"grab"},customPins:{string:{backgroundColor:"red",transform:"rotate(45deg)"}}},link:{selected:{stroke:"white",strokeWidth:"3px",fill:"none"},unselected:{stroke:"rgba(170, 170, 170, 0.75)",strokeWidth:"3px",fill:"none"}},connectors:{leftText:{width:"40%",textOverflow:"ellipsis",overflow:"hidden"},string:{width:"100%",backgroundColor:"#585858",color:"white",border:0,outline:"none"},number:{width:"60%",boxSizing:"border-box",backgroundColor:"#585858",color:"white",border:0,outline:"none",textAlign:"right",borderRadius:"8px",paddingRight:"5px"},select:{width:"60%",backgroundColor:"#585858",boxSizing:"border-box",color:"white",border:0,outline:"none",textAlign:"right",borderRadius:"8px",paddingRight:"5px"},button:{width:"100%",backgroundColor:"#585858",color:"white",border:0,outline:"none"}}},buildBackgroundStyle:function(t){var n=String(200*t.zoom);return{backgroundColor:"#232323",backgroundPosition:"".concat(t.topLeftCorner.x,"px ").concat(t.topLeftCorner.y,"px"),backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='".concat(n,"' height='").concat(n,"' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='black' fill-opacity='0.4'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")")}}},x=Object(r.createContext)(O),C=function(){return C=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},C.apply(this,arguments)};function k(t){var n=Object(r.useContext)(x).buildBackgroundStyle,e=t.panZoomInfo,o=t.children,i={position:"relative",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"};return n&&(i=C(C({},i),n(e))),a.a.createElement("div",{style:i},o)}var j=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),w=function(){return w=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},w.apply(this,arguments)},I=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return j(n,t),n.prototype.shouldComponentUpdate=function(t){return!h.isEqual(this.props,t)},n.prototype.onSelectLink=function(t){var n=this.props,e=n.linkId,o=n.onSelectLink;o&&e&&o(e,t.shiftKey)},n.prototype.render=function(){var t,n,e,o,i,r,c=this.context.theme,s=this.props,u=s.linkId,l=s.linkPosition,p=s.isLinkSelected,d=l.inputPinPosition.x,v=l.inputPinPosition.y,h=l.outputPinPosition.x,f=l.outputPinPosition.y,m=function(t,n){var e=Math.abs(n.x-t.x)/2,o=n.x<t.x?n.x+e:n.x-e,i=Math.abs(n.y-t.y)/2;return{x:o,y:n.y<t.y?n.y+i:n.y-i}}(l.inputPinPosition,l.outputPinPosition),y="M".concat(d,",").concat(v," C").concat(m.x,",").concat(v," ").concat(m.x,",").concat(f," ").concat(h,",").concat(f),b=p?w(w({},null===(t=null===c||void 0===c?void 0:c.link)||void 0===t?void 0:t.selected),null===(e=null===(n=this.props.link)||void 0===n?void 0:n.theme)||void 0===e?void 0:e.selected):w(w({},null===(o=null===c||void 0===c?void 0:c.link)||void 0===o?void 0:o.unselected),null===(r=null===(i=this.props.link)||void 0===i?void 0:i.theme)||void 0===r?void 0:r.unselected);return a.a.createElement("path",{id:"link_".concat(u),d:y,style:b,onClick:this.onSelectLink.bind(this)})},n}(r.Component),E=I;I.contextType=x;var _=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),N=function(){return N=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},N.apply(this,arguments)},L=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _(n,t),n.prototype.shouldComponentUpdate=function(t){return!h.isEqual(this.props,t)},n.prototype.onSelectLink=function(t){var n=this.props,e=n.linkId,o=n.onSelectLink;o&&e&&o(e,t.shiftKey)},n.prototype.render=function(){var t,n,e,o,i,r,c=this.context.theme,s=this.props,u=s.linkId,l=s.linkPosition,p=s.isLinkSelected?N(N({},null===(t=null===c||void 0===c?void 0:c.link)||void 0===t?void 0:t.selected),null===(e=null===(n=this.props.link)||void 0===n?void 0:n.theme)||void 0===e?void 0:e.selected):N(N({},null===(o=null===c||void 0===c?void 0:c.link)||void 0===o?void 0:o.unselected),null===(r=null===(i=this.props.link)||void 0===i?void 0:i.theme)||void 0===r?void 0:r.unselected);return a.a.createElement("line",{id:"link_".concat(u),x1:l.inputPinPosition.x,y1:l.inputPinPosition.y,x2:l.outputPinPosition.x,y2:l.outputPinPosition.y,style:p,onClick:this.onSelectLink.bind(this)})},n}(r.Component),S=L;L.contextType=x;var T=function(){return T=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},T.apply(this,arguments)};function M(t){var n=t.link;return"line"===(null===n||void 0===n?void 0:n.linkType)?a.a.createElement(S,T({},t)):a.a.createElement(E,T({},t))}function z(t){var n=t.links,e=t.linksPositions,o=t.selectedItems,i=t.draggedLink,r=t.onSelectItem;return a.a.createElement("svg",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"visible"},id:"link_canvas"},Object.keys(n).filter((function(t){return t in e})).map((function(t){return M({linkId:t,link:n[t],key:t,linkPosition:e[t],isLinkSelected:f.a.some(o,{id:t,type:"link"}),onSelectLink:function(t,n){return r({id:t,type:"link"},n)}})})),i&&M({linkPosition:i,isLinkSelected:!1}))}var F=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),R=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return F(n,t),n.prototype.shouldComponentUpdate=function(t){return!h.isEqual(this.props,t)},n.prototype.render=function(){var t=this.props.connector;return a.a.createElement("div",{className:"node-background",style:{textAlign:t.pinLayout===i.RIGHT_PIN?"right":"left"}},t.name)},n}(r.Component),U=R,H=function(t){var n=t.message;return a.a.createElement("div",{style:{color:"red"}},"error: ".concat(n))},J=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),D=function(){return D=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},D.apply(this,arguments)},Z=function(t){function n(n){var e=t.call(this,n)||this;return e.textAreaRef=a.a.createRef(),e.onChange=e.onChange.bind(e),e.onMouseUp=e.onMouseUp.bind(e),e}return J(n,t),n.prototype.shouldComponentUpdate=function(t){return!f.a.isEqual(this.props,t)},n.prototype.onChange=function(t){var n=this.props,e=n.nodeId,o=n.cId,i=n.connector;(0,n.onConnectorUpdate)(e,o,Object(v.a)(i,(function(n){n.data.value=t.currentTarget.value})))},n.prototype.onMouseUp=function(){if(this.textAreaRef.current){var t=this.props,n=t.nodeId,e=t.cId,o=t.connector,i=t.onConnectorUpdate,r=this.textAreaRef.current.style.height;i(n,e,Object(v.a)(o,(function(t){t.data.height=r})))}},n.prototype.render=function(){var t,n=this.context.theme,e=this.props.connector;if(!("value"in e.data)){return a.a.createElement(H,{message:"'string' connector types must provide a string field named 'value'"})}var o="height"in e.data?e.data.height:100;return a.a.createElement("textarea",{ref:this.textAreaRef,style:D({height:o,whiteSpace:"pre",resize:"vertical"},null===(t=null===n||void 0===n?void 0:n.connectors)||void 0===t?void 0:t.string),value:e.data.value,onChange:this.onChange,onMouseUp:this.onMouseUp,placeholder:e.name})},n}(r.Component),A=Z;Z.contextType=x;var G=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),B=function(t){function n(n){var e=t.call(this,n)||this;return e.onChange=e.onChange.bind(e),e}return G(n,t),n.prototype.onChange=function(){var t=this.props,n=t.nodeId,e=t.cId,o=t.connector;(0,t.onConnectorUpdate)(n,e,Object(v.a)(o,(function(t){t.data.value=!t.data.value})))},n.prototype.render=function(){var t=this.props.connector;if(!("value"in t.data)){return a.a.createElement(H,{message:"'check_box' connector types must provide a bool field named 'value'"})}return a.a.createElement(a.a.Fragment,null,a.a.createElement("input",{tabIndex:-1,checked:t.data.value,onChange:this.onChange,type:"checkbox",style:{backgroundColor:"#585858",color:"white",border:0,outline:"none"}}),t.name)},n}(r.Component),V=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),q=function(t){function n(n){var e=t.call(this,n)||this;return e.onChange=e.onChange.bind(e),e}return V(n,t),n.prototype.shouldComponentUpdate=function(t){return!f.a.isEqual(this.props,t)},n.prototype.onChange=function(t){var n=this.props,e=n.nodeId,o=n.cId,i=n.connector,r=n.onConnectorUpdate;isNaN(Number(t.currentTarget.value))||r(e,o,Object(v.a)(i,(function(n){n.data.value=t.currentTarget.value})))},n.prototype.render=function(){var t,n,e=this.context.theme,o=this.props.connector;if(!("value"in o.data)){return a.a.createElement(H,{message:"'number' connector types must provide a string field named 'value'"})}return a.a.createElement("div",{style:{display:"flex"}},a.a.createElement("div",{className:"node-background",style:null===(t=null===e||void 0===e?void 0:e.connectors)||void 0===t?void 0:t.leftText},o.name),a.a.createElement("input",{disabled:"disabled"in o.data&&o.data.disabled,style:null===(n=null===e||void 0===e?void 0:e.connectors)||void 0===n?void 0:n.number,value:o.data.value,onChange:this.onChange,placeholder:o.name}))},n}(r.Component),X=q;q.contextType=x;var Y=function(t){var n,e,o=t.connector,i=t.nodeId,c=t.cId,s=t.onConnectorUpdate,u=Object(r.useContext)(x).theme;if(!("values"in o.data)||!("selected_index"in o.data)){return a.a.createElement(H,{message:"'select' connector types must provide a string array field named 'values' and a number field 'selected_index'"})}var l=Object(r.useCallback)((function(t){var n=Object(v.a)(o,(function(n){n.data.selected_index=t}));s(i,c,n)}),[s,i,c,o]);return a.a.createElement("div",{style:{display:"flex"}},a.a.createElement("div",{className:"node-background",style:null===(n=null===u||void 0===u?void 0:u.connectors)||void 0===n?void 0:n.leftText},o.name),a.a.createElement("select",{onChange:function(t){return l(t.target.selectedIndex)},style:null===(e=null===u||void 0===u?void 0:u.connectors)||void 0===e?void 0:e.select,defaultValue:o.data.values[o.data.selected_index]},o.data.values.map((function(t){return a.a.createElement("option",{key:t,value:t},t)}))))},K=function(t){var n,e=t.connector,o=t.node,i=Object(r.useContext)(x).theme;if(!("label"in e.data)||!("onClick"in e.data)){return a.a.createElement(H,{message:"'button' connector types must provide a string field named 'label' and a callback 'onClick'"})}return a.a.createElement("button",{style:null===(n=null===i||void 0===i?void 0:i.connectors)||void 0===n?void 0:n.button,onClick:function(){return e.data.onClick(o)}},e.data.label)},W=function(){return W=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},W.apply(this,arguments)};var Q=function(){return Q=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},Q.apply(this,arguments)},$=function(){function t(){this.onMouseMoveCb=function(){return null},this.onMouseUpCb=function(){return null},this.initialPos={x:0,y:0},this.finalPos={x:0,y:0},this.tmpPos={x:0,y:0},this.getZoom=function(){return 1},this.targetClassName="",this.lastZoom=0,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this)}return t.prototype.onMouseDown=function(t,n,e,o,i){window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),this.getZoom=e,this.initialPos=n,this.finalPos={x:n.x,y:n.y};var r=e();this.lastZoom=r,this.tmpPos={x:t.pageX/r,y:t.pageY/r},this.onMouseMoveCb=o,this.onMouseUpCb=i},t.prototype.onMouseMove=function(t){var n=this.getZoom(),e={x:t.pageX/this.lastZoom-this.tmpPos.x,y:t.pageY/this.lastZoom-this.tmpPos.y};this.finalPos.x+=e.x,this.finalPos.y+=e.y,this.tmpPos={x:t.pageX/n,y:t.pageY/n};var o=t.target.className;"string"===typeof o&&(this.targetClassName=o),this.onMouseMoveCb(Q({},this.initialPos),Q({},this.finalPos),e,this.targetClassName),this.lastZoom=n},t.prototype.onMouseUp=function(t){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),this.onMouseUpCb(Q({},this.initialPos),Q({},this.finalPos),t)},t}(),tt=function(){return tt=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},tt.apply(this,arguments)},nt=function(t){var n,e,o,i,c=t.className,s=t.contentType,u=t.leftPinPosition,l=t.pinPxRadius,p=t.pinColor,d=t.onMouseDown,v=Object(r.useContext)(x).theme,h=void 0;(null===(n=null===v||void 0===v?void 0:v.node)||void 0===n?void 0:n.customPins)&&(null===(e=null===v||void 0===v?void 0:v.node)||void 0===e?void 0:e.customPins[s])&&(h=null===(o=null===v||void 0===v?void 0:v.node)||void 0===o?void 0:o.customPins[s]);var f=tt(tt({position:"absolute",width:"".concat(2*l,"px"),height:"".concat(2*l,"px"),left:"".concat(u,"px"),top:"calc(50% - ".concat(l,"px)")},null===(i=null===v||void 0===v?void 0:v.node)||void 0===i?void 0:i.basePin),h);return p&&(f.backgroundColor=p),a.a.createElement("div",{className:c,style:f,onMouseDown:d})},et=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ot=function(t){function n(n){var e=t.call(this,n)||this;return e.dragWrapper=new $,e.connectorRef=a.a.createRef(),e.leftPinPos=null,e.rightPinPos=null,e.pinPxRadius=6,e.onMouseDown=e.onMouseDown.bind(e),e.onPinPositionUpdate=e.onPinPositionUpdate.bind(e),e}return et(n,t),n.prototype.componentDidMount=function(){this.onPinPositionUpdate()},n.prototype.componentDidUpdate=function(){this.onPinPositionUpdate()},n.prototype.onPinPositionUpdate=function(){var t=this.props,n=t.cId,e=t.onPinPositionUpdate,i=this.getConnectorPinPosition(o.LEFT),r=this.getConnectorPinPosition(o.RIGHT);f.a.isEqual(i,this.leftPinPos)&&f.a.isEqual(r,this.rightPinPos)||(this.leftPinPos=i,this.leftPinPos=r,e(n,i,r))},n.prototype.onMouseDown=function(t,n){var e=this.props,i=e.nodeId,r=e.cId,a=e.getZoom,c=e.onUpdatePreviewLink,s=e.onCreateLink,u=this.getConnectorPinPosition(t);if(u&&c&&s){this.dragWrapper.onMouseDown(n,u,a,(function(t,n){c({linkId:"preview",outputPinPosition:n,inputPinPosition:t})}),(function(n,e,a){var u=null;a.target&&("string"===typeof a.target.className&&(u=a.target.className.match(/node-(.+)-connector-(.+)-(left|right)/)));null!==u&&s({inputNodeId:i,inputPinId:r,inputPinSide:t===o.LEFT?o.LEFT:o.RIGHT,outputNodeId:u[1],outputPinId:u[2],outputPinSide:"left"===u[3]?o.LEFT:o.RIGHT,linkType:"bezier"}),c(void 0)}))}},n.prototype.getConnectorPinPosition=function(t){var n=this.props,e=n.connector,r=n.node,a=this.connectorRef.current;return!a||e.pinLayout===i.NO_PINS||t===o.LEFT&&e.pinLayout===i.RIGHT_PIN||t===o.RIGHT&&e.pinLayout===i.LEFT_PIN?null:{x:t===o.RIGHT?r.width+r.position.x:r.position.x,y:r.position.y+a.offsetTop+a.offsetHeight/2}},n.prototype.render=function(){var t=this,n=this.props,e=n.connector,r=n.node,c=n.nodeId,s=n.cId,u=n.createCustomConnectorComponent,l=null;return u&&(l=u(this.props)),l||(l=function(t){var n=t.connector;return"string"===n.contentType?a.a.createElement(A,W({},t)):"number"===n.contentType?a.a.createElement(X,W({},t)):"check_box"===n.contentType?a.a.createElement(B,W({},t)):"select"===n.contentType?a.a.createElement(Y,W({},t)):"button"===n.contentType?a.a.createElement(K,W({},t)):a.a.createElement(U,W({},t))}(this.props)),a.a.createElement("div",{className:"node-background",ref:this.connectorRef,style:{position:"relative",paddingTop:3}},[i.LEFT_PIN,i.BOTH_PINS].includes(e.pinLayout)&&a.a.createElement(nt,{className:"node-".concat(c,"-connector-").concat(s,"-left"),contentType:e.contentType,pinPxRadius:this.pinPxRadius,leftPinPosition:-this.pinPxRadius,onMouseDown:function(n){return t.onMouseDown(o.LEFT,n)},pinColor:this.props.connector.leftPinColor}),[i.RIGHT_PIN,i.BOTH_PINS].includes(e.pinLayout)&&a.a.createElement(nt,{className:"node-".concat(c,"-connector-").concat(s,"-right"),contentType:e.contentType,pinPxRadius:this.pinPxRadius,leftPinPosition:r.width-this.pinPxRadius,onMouseDown:function(n){return t.onMouseDown(o.RIGHT,n)},pinColor:this.props.connector.rightPinColor}),a.a.createElement("div",{className:"node-background",style:{overflow:"hidden",paddingLeft:2*this.pinPxRadius,paddingRight:2*this.pinPxRadius}},l))},n}(r.Component),it=function(){return it=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},it.apply(this,arguments)};function rt(t){var n,e,o=t.node,i=Object(r.useContext)(x).theme;return a.a.createElement("div",{className:"node-background node-header",style:it(it({},null===(n=i.node)||void 0===n?void 0:n.header),null===(e=o.theme)||void 0===e?void 0:e.header)},o.name)}var at=function(){return at=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},at.apply(this,arguments)};function ct(t){var n,e,o=t.node,i=Object(r.useContext)(x).theme;return a.a.createElement("div",{className:"node-background node-footer",style:at(at({},null===(n=null===i||void 0===i?void 0:i.node)||void 0===n?void 0:n.footer),null===(e=null===o||void 0===o?void 0:o.theme)||void 0===e?void 0:e.footer)})}var st=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ut=function(){return ut=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},ut.apply(this,arguments)},lt=function(t){function n(n){var e=t.call(this,n)||this;return e.dragWrapper=new $,e.pinPositions={},e.onMouseDown=e.onMouseDown.bind(e),e.onPinPositionUpdate=e.onPinPositionUpdate.bind(e),e}return st(n,t),n.prototype.shouldComponentUpdate=function(t){var n=this.props,e=n.node;return n.isNodeSelected!==t.isNodeSelected||!f.a.isEqual(e,t.node)},n.prototype.onMouseDown=function(t){var n=this.props,e=n.nodeId,o=n.getZoom,i=n.onNodeMoveStart,r=n.onNodeMove,a=n.onNodeMoveEnd;if(i&&r&&a){var c=!0,s="";if(t.target){var u=t.target.className;"string"===typeof u&&u.includes("node-background")&&(s=u,c=!1)}if(!c){i(e,t.shiftKey);var l=o(),p={x:t.pageX/l,y:t.pageY/l};this.dragWrapper.onMouseDown(t,p,o,(function(t,n,e){s.includes("node-footer")?r(0,0,e.x):r(e.x,e.y,0)}),(function(t,n,o){a(e,!m(t,n),o.shiftKey)}))}}},n.prototype.onPinPositionUpdate=function(t,n,e){var o=this.props,r=o.nodeId,a=o.node,c=o.onNodePinPositionsUpdate;this.pinPositions[t]=[n,e];var s=Object.keys(a.connectors).filter((function(t){return a.connectors[t].pinLayout!==i.NO_PINS})).length;Object.keys(this.pinPositions).length===s&&c(r,this.pinPositions)},n.prototype.render=function(){var t,n,e,o,i,r,c=this,s=this.context.theme,u=this.props,l=u.nodeId,p=u.node,d=u.isNodeSelected,v=this.props,h=v.onCreateLink,f=v.onUpdatePreviewLink,m=v.getZoom,y=v.onConnectorUpdate,b=this.props.createCustomConnectorComponent,g={position:"absolute",width:"".concat(p.width,"px"),top:"".concat(p.position.y,"px"),left:"".concat(p.position.x,"px")},P=d?ut(ut({},null===(t=null===s||void 0===s?void 0:s.node)||void 0===t?void 0:t.selected),null===(n=null===p||void 0===p?void 0:p.theme)||void 0===n?void 0:n.selected):ut(ut({},null===(e=null===s||void 0===s?void 0:s.node)||void 0===e?void 0:e.unselected),null===(o=null===p||void 0===p?void 0:p.theme)||void 0===o?void 0:o.unselected);return a.a.createElement("div",{className:"node-background",style:ut(ut({},g),P),onMouseDown:this.onMouseDown,id:"node_".concat(l)},a.a.createElement(rt,{node:p}),a.a.createElement("div",{style:ut(ut({},null===(i=null===s||void 0===s?void 0:s.node)||void 0===i?void 0:i.body),null===(r=null===p||void 0===p?void 0:p.theme)||void 0===r?void 0:r.body)},Object.keys(p.connectors).map((function(t){return a.a.createElement(ot,{nodeId:l,cId:t,getZoom:m,node:p,key:t,connector:p.connectors[t],onCreateLink:h,onUpdatePreviewLink:f,onConnectorUpdate:y,onPinPositionUpdate:c.onPinPositionUpdate,createCustomConnectorComponent:b})}))),a.a.createElement(ct,{node:p}))},n}(r.Component);lt.contextType=x;var pt=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),dt=function(t){function n(n){var e=t.call(this,n)||this;return e.onNodeMoveStart=e.onNodeMoveStart.bind(e),e.onNodeMove=e.onNodeMove.bind(e),e.onNodeMoveEnd=e.onNodeMoveEnd.bind(e),e}return pt(n,t),n.prototype.onNodeMoveStart=function(t,n){var e=this,o=this.props,i=o.selectedItems,r=o.onSelectItem,a={id:t,type:"node"},c=!1;i.forEach((function(t){t.id===a.id&&t.type===a.type&&(c=!0)})),c||(this.lastSettedSelection=a,i.forEach((function(n){n.id===t&&"node"===n.type&&(e.lastSettedSelection=void 0)})),n&&this.lastSettedSelection&&r(a,n),n||r(a,n))},n.prototype.onNodeMove=function(t,n,e){var o=this;this.props.selectedItems.forEach((function(i){if("node"===i.type){var r=o.props,a=r.nodes,c=r.onNodeMove,s=a[i.id].position.x+t,u=a[i.id].position.y+n,l=a[i.id].width+e;c(i.id,s,u,l>100?l:100)}}))},n.prototype.onNodeMoveEnd=function(t,n,e){var o=this.props.onSelectItem,i={id:t,type:"node"};(n||e)&&(n||!e||f.a.isEqual(i,this.lastSettedSelection))||o(i,e),this.lastSettedSelection=void 0},n.prototype.render=function(){var t=this,n=this.props,e=n.nodes,o=n.selectedItems,i=this.props,r=i.getZoom,c=i.onCreateLink,s=i.onUpdatePreviewLink,u=i.onNodePinPositionsUpdate,l=this.props,p=l.onConnectorUpdate,d=l.createCustomConnectorComponent;return a.a.createElement(a.a.Fragment,null,Object.keys(e).map((function(n){return a.a.createElement(lt,{nodeId:n,key:n,node:e[n],isNodeSelected:f.a.some(o,{id:n,type:"node"}),getZoom:r,onNodeMoveStart:t.onNodeMoveStart,onNodeMove:t.onNodeMove,onNodeMoveEnd:t.onNodeMoveEnd,onCreateLink:c,onUpdatePreviewLink:s,onNodePinPositionsUpdate:u,onConnectorUpdate:p,createCustomConnectorComponent:d})})))},n}(a.a.Component),vt=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),ht=function(t,n,e){if(e||2===arguments.length)for(var o,i=0,r=n.length;i<r;i++)!o&&i in n||(o||(o=Array.prototype.slice.call(n,0,i)),o[i]=n[i]);return t.concat(o||Array.prototype.slice.call(n))};Object(v.b)();var ft,mt=function(t){function n(n){var e=t.call(this,n)||this;return e.nodesPinPositions={},e.mainDivRef=a.a.createRef(),e.state={linksPositions:{}},e.getZoom=e.getZoom.bind(e),e.onUpdatePreviewLink=e.onUpdatePreviewLink.bind(e),e.onNodePinPositionsUpdate=e.onNodePinPositionsUpdate.bind(e),e.onSelectItem=e.onSelectItem.bind(e),e.onCreateLink=e.onCreateLink.bind(e),e.onConnectorUpdate=e.onConnectorUpdate.bind(e),e.onNodeMove=e.onNodeMove.bind(e),e.filterRenderedNodes=e.filterRenderedNodes.bind(e),e.filterRenderedLinks=e.filterRenderedLinks.bind(e),e}return vt(n,t),n.prototype.componentDidMount=function(){this.updateLinkPositions()},n.prototype.componentDidUpdate=function(){this.updateLinkPositions()},n.prototype.onSelectItem=function(t,n){var e=this.props,o=e.selectedItems,i=e.onSelectedItems;if(t||n){if(t&&n&&f.a.some(o,t)){var r=ht([],o,!0),a=-1;o.forEach((function(n,e){n.id===t.id&&n.type===t.type&&(a=e)})),-1!==a&&r.splice(a,1),i(r)}else if(t&&!f.a.some(o,t)){r=ht([],o,!0);n||(r=[]),r.push(t),i(r)}}else i([]);!n&&t&&i([t])},n.prototype.onUpdatePreviewLink=function(t){this.setState({draggedLink:t})},n.prototype.onNodePinPositionsUpdate=function(t,n){this.nodesPinPositions[t]=n},n.prototype.onCreateLink=function(t){var n=this.props.onCreateLink;n&&t.inputPinSide!==t.outputPinSide&&t.inputNodeId!==t.outputNodeId&&n(t)},n.prototype.onNodeMove=function(t,n,e,o){var i=this.props.onNodeMove;i&&i(t,n,e,o)},n.prototype.onConnectorUpdate=function(t,n,e){var o=this.props.onConnectorUpdate;o&&o(t,n,e)},n.prototype.getZoom=function(){return this.props.panZoomInfo.zoom},n.prototype.updateLinkPositions=function(){var t=this,n=this.props.links,e=this.state.linksPositions,i=!1,r=Object(v.c)(e,(function(r){Object.keys(n).forEach((function(e){var a=n[e];if(a.inputNodeId in t.nodesPinPositions!==!1&&a.outputNodeId in t.nodesPinPositions!==!1){var c=t.nodesPinPositions[a.inputNodeId][a.inputPinId],s=t.nodesPinPositions[a.outputNodeId][a.outputPinId];if(c&&s){var u=c[a.inputPinSide===o.LEFT?0:1],l=s[a.outputPinSide===o.LEFT?0:1];u&&l&&(e in r&&m(r[e].inputPinPosition,u)&&m(r[e].outputPinPosition,l)||(r[e]={linkId:e,inputPinPosition:u,outputPinPosition:l},i=!0))}}})),Object.keys(e).forEach((function(t){t in n||(delete r[t],i=!0)}))}));i&&this.setState({linksPositions:r})},n.prototype.filterRenderedNodes=function(){var t=this.props,n=t.nodes,e=t.panZoomInfo,o=this.mainDivRef.current;if(!o)return n;var i=-e.topLeftCorner.x/e.zoom-50,r=-e.topLeftCorner.y/e.zoom-50,a=i+o.offsetWidth/e.zoom+100,c=r+o.offsetHeight/e.zoom+100,s={},u=function(t,n,e){return t>=n&&t<=e};return Object.keys(n).forEach((function(t){var e=n[t],o=u(i,e.position.x,e.position.x+e.width)||u(e.position.x,i,a),l=u(r,e.position.y,e.position.y+1e3)||u(e.position.y,r,c);o&&l&&(s[t]=e)})),s},n.prototype.filterRenderedLinks=function(t){var n=this.props.links,e={};return Object.keys(n).forEach((function(o){var i=n[o];(t.includes(i.inputNodeId)||t.includes(i.outputNodeId))&&(e[o]=i)})),e},n.prototype.render=function(){var t=this.props,n=t.selectedItems,e=t.panZoomInfo,o=t.theme,i=this.props,r=i.onPanZoomInfo,c=i.createCustomConnectorComponent,s=this.state,u=s.draggedLink,l=s.linksPositions,p=this.filterRenderedNodes(),d=this.filterRenderedLinks(Object.keys(p));return a.a.createElement(x.Provider,{value:o||O},a.a.createElement("div",{style:{width:"100%",height:"100%"},ref:this.mainDivRef},a.a.createElement(k,{panZoomInfo:e},a.a.createElement(P,{panZoomInfo:e,onPanZoomInfo:r,onSelectItem:this.onSelectItem},a.a.createElement(z,{links:d,linksPositions:l,draggedLink:u,selectedItems:n,onSelectItem:this.onSelectItem}),a.a.createElement(dt,{nodes:p,getZoom:this.getZoom,onNodeMove:this.onNodeMove,onCreateLink:this.onCreateLink,onUpdatePreviewLink:this.onUpdatePreviewLink,onConnectorUpdate:this.onConnectorUpdate,onNodePinPositionsUpdate:this.onNodePinPositionsUpdate,selectedItems:n,onSelectItem:this.onSelectItem,createCustomConnectorComponent:c})))))},n}(r.Component),yt=function(t){var n=t.name,e=t.onClick,o=t.onMouseEnter,i=t.onMouseLeave;return a.a.createElement("div",{onClick:e,onMouseEnter:o,onMouseLeave:i},n)},bt=function(t){var n=t.items;return a.a.createElement(a.a.Fragment,null,Object.keys(n).map((function(t){var e=n[t];return a.a.createElement(yt,{name:e.name,onClick:e.onClick,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,key:t})})))},gt=function(t){var n=t.menuTitle,e=t.items,o=a.a.useState(""),i=o[0],r=o[1],c=a.a.useCallback((function(t){r(t.currentTarget.value)}),[i]),s=Object(v.a)(e,(function(t){Object.keys(e).forEach((function(n){var o=e[n].name.toLowerCase(),r=i.toLowerCase();""===i||o.includes(r)||delete t[n]}))}));return a.a.createElement(a.a.Fragment,null,n,a.a.createElement("br",null),a.a.createElement("input",{value:i,onChange:c,placeholder:"Filter options"}),a.a.createElement(bt,{items:s}))},Pt=function(){return Pt=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},Pt.apply(this,arguments)},Ot=function(t){var n=t.node,e=t.createCustomConnectorComponent,o=a.a.useRef(null),i=null;if(n&&o&&o.current){var r=o.current.getBoundingClientRect(),c=Pt({},n);c.position={x:10,y:10},c.width=r.width-20,i=n?a.a.createElement(lt,{nodeId:"0",getZoom:function(){return 1},isNodeSelected:!0,node:c,onConnectorUpdate:function(){return null},onNodePinPositionsUpdate:function(){return null},createCustomConnectorComponent:e}):null}return a.a.createElement("div",{ref:o,style:{position:"relative",gridArea:"preview",overflow:"hidden",width:"500px",height:"500px"}},i)},xt=function(t){var n=t.nodesSchema,e=t.onNodeSelection,o=t.createCustomConnectorComponent,i=t.onMouseHover,r=a.a.useState(""),c=r[0],s=r[1],u={};Object.keys(n).forEach((function(t){u[t]={name:n[t].name,onMouseEnter:function(){s(t)},onMouseLeave:function(){s("")},onClick:function(){e(t)}}}));var l=a.a.useCallback((function(){i(!0)}),[i]),p=a.a.useCallback((function(){i(!1)}),[i]);return a.a.createElement("div",{style:{display:"flex"},onMouseLeave:p,onMouseEnter:l},a.a.createElement("div",null,a.a.createElement(gt,{menuTitle:"Add a new node",items:u})),a.a.createElement(Ot,{node:c?n[c]:null,createCustomConnectorComponent:o}))},Ct=function(t){var n=t.onMouseHover,e=t.onDeleteSelection,o={};o.delete_selection={name:"Delete selection",onClick:function(){e()}};var i=a.a.useCallback((function(){n(!0)}),[n]),r=a.a.useCallback((function(){n(!1)}),[n]);return a.a.createElement("div",{onMouseLeave:r,onMouseEnter:i},a.a.createElement(gt,{menuTitle:"Selection management",items:o}))},kt=e(5),jt=e(6),wt=function(){function t(n,e,o,i){Object(kt.a)(this,t),this[l.b]=!0,this.name=void 0,this.position=void 0,this.width=void 0,this.connectors=void 0,this.name=n,this.width=e,this.position=o,this.connectors=i}return Object(jt.a)(t,[{key:"compute",value:function(t,n,e){var r=this,a=Object.keys(t).find((function(n){return t[n]===r}));if(a){var c={};return Object.keys(this.connectors).forEach((function(s){var u=r.connectors[s];if(u.pinLayout===i.LEFT_PIN||u.pinLayout===i.BOTH_PINS){var l=function(t,n,e){var o=[];return Object.keys(t).forEach((function(i){var r=t[i];(r.inputNodeId===n&&r.inputPinId===e||r.outputNodeId===n&&r.outputPinId===e)&&o.push(r)})),o}(n,a,s);l.forEach((function(r){var l=r.inputNodeId!==a?r.inputNodeId:r.outputNodeId,p=r.inputNodeId===l?r.inputPinId:r.outputPinId;if((r.inputNodeId===l?r.inputPinSide:r.outputPinSide)!==o.LEFT||u.pinLayout!==i.BOTH_PINS){var d=t[l].compute(t,n,e);s in c||(c[s]=[]),c[s].push(d[p])}}))}})),this.computeSpecific(c,a,e)}return{}}}],[{key:"initFromJson",value:function(t,n){n.name=t.name,n.width=t.width,n.position=t.position,n.connectors=t.connectors}}]),t}(),It=e(8),Et=e(7);!function(t){t.Canvas="canvas",t.Color="color",t.Number="number",t.Rectangle="rectangle",t.Rotate="rotate",t.Timer="timer",t.Translate="translate",t.IfElse="if-else",t.String="string",t.Split="split",t.Operation="operation",t.Log="log"}(ft||(ft={}));var _t=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Canvas,430,{x:0,y:0},{0:{name:"draw",pinLayout:i.LEFT_PIN,contentType:"canvas",data:{canvas_width:400,canvas_height:400}},1:{name:"width",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:400}},2:{name:"height",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:400}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t,n,e){var o="1"in t?t[1][0]:this.connectors[1].data.value,i="2"in t?t[2][0]:this.connectors[2].data.value;if("canvas_ctx"in this.connectors[0].data){var r=this.connectors[0].data.canvas_ctx;"clearRect"in r&&(e((function(e){return Object(l.a)(e,(function(e){e[n].connectors[0].data.canvas_width=o,e[n].connectors[0].data.canvas_height=i,e[n].connectors[1].data.disabled="1"in t,e[n].connectors[1].data.value=o,e[n].connectors[2].data.disabled="2"in t,e[n].connectors[2].data.value=i}))})),r.canvas.width=o,r.canvas.height=i,r.fillStyle="white",r.fillRect(0,0,o,i),r.fillStyle="black",t[0]&&t[0].forEach((function(t){t(r)})))}return{}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Nt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Rectangle,150,{x:0,y:0},{0:{name:"draw",pinLayout:i.RIGHT_PIN,contentType:"none",data:{}},1:{name:"x",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},2:{name:"y",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},3:{name:"width",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:100,disabled:!1}},4:{name:"height",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:100,disabled:!1}},5:{name:"color",pinLayout:i.LEFT_PIN,contentType:"none",data:{value:"black"},leftPinColor:"orange"}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t,n,e){var o="1"in t?t[1][0]:this.connectors[1].data.value,i="2"in t?t[2][0]:this.connectors[2].data.value,r="3"in t?t[3][0]:this.connectors[3].data.value,a="4"in t?t[4][0]:this.connectors[4].data.value,c="5"in t?t[5][0]:this.connectors[5].data.value;e((function(e){return Object(l.a)(e,(function(e){e[n].connectors[1].data.disabled="1"in t,e[n].connectors[1].data.value=o,e[n].connectors[2].data.disabled="2"in t,e[n].connectors[2].data.value=i,e[n].connectors[3].data.disabled="3"in t,e[n].connectors[3].data.value=r,e[n].connectors[4].data.disabled="4"in t,e[n].connectors[4].data.value=a}))}));return{0:function(t){t.fillStyle=c,t.fillRect(o,i,r,a),t.fillStyle="black"}}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Lt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Rotate,150,{x:0,y:0},{0:{name:"draw",pinLayout:i.BOTH_PINS,contentType:"none",data:{}},1:{name:"angle",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value;n=n*Math.PI/180;return{0:function(e){e.rotate(n),t[0]&&t[0].forEach((function(t){t(e)})),e.rotate(-n)}}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),St=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Number,170,{x:0,y:0},{0:{name:"number",pinLayout:i.RIGHT_PIN,contentType:"number",data:{value:0}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Tt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Color,150,{x:0,y:0},{0:{name:"color",pinLayout:i.RIGHT_PIN,contentType:"canvas",data:{canvas_width:40,canvas_height:40},rightPinColor:"orange"},1:{name:"red",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0}},2:{name:"green",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0}},3:{name:"blue",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t,n,e){var o="1"in t?t[1][0]:this.connectors[1].data.value,i="2"in t?t[2][0]:this.connectors[2].data.value,r="3"in t?t[3][0]:this.connectors[3].data.value;i=i>255?255:i<0?0:i,r=r>255?255:r<0?0:r;var a="rgb(".concat(o=o>255?255:o<0?0:o,", ").concat(i,", ").concat(r,")"),c=this.width-30;if("canvas_ctx"in this.connectors[0].data){var s=this.connectors[0].data.canvas_ctx;"clearRect"in s&&(e((function(e){return Object(l.a)(e,(function(e){e[n].connectors[0].data.canvas_width=c,e[n].connectors[1].data.disabled="1"in t,e[n].connectors[1].data.value=o,e[n].connectors[2].data.disabled="2"in t,e[n].connectors[2].data.value=i,e[n].connectors[3].data.disabled="3"in t,e[n].connectors[3].data.value=r}))})),s.canvas.width=c,s.fillStyle=a,s.fillRect(0,0,this.width,this.connectors[0].data.canvas_height))}return{0:a}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Mt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Timer,150,{x:0,y:0},{0:{name:"count",pinLayout:i.RIGHT_PIN,contentType:"number",data:{value:"0"}},1:{name:"is_running",pinLayout:i.LEFT_PIN,contentType:"check_box",data:{value:!1}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),zt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Translate,100,{x:0,y:0},{0:{name:"draw",pinLayout:i.BOTH_PINS,contentType:"none",data:{}},1:{name:"x",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0}},2:{name:"y",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value,e="2"in t?t[2][0]:this.connectors[2].data.value;return{0:function(o){o.translate(n,e),t[0]&&t[0].forEach((function(t){t(o)})),o.translate(-n,-e)}}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Ft=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.IfElse,100,{x:0,y:0},{0:{name:"out_value",pinLayout:i.RIGHT_PIN,contentType:"none",data:{}},1:{name:"test",pinLayout:i.LEFT_PIN,contentType:"check_box",data:{value:!1}},2:{name:"if_value",pinLayout:i.LEFT_PIN,contentType:"none",data:{}},3:{name:"else_value",pinLayout:i.LEFT_PIN,contentType:"none",data:{}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value,e="2"in t?t[2][0]:null,o="3"in t?t[3][0]:null,i={};return n&&e?i={0:e}:!n&&e&&(i={0:o}),i}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Rt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.String,100,{x:0,y:0},{0:{name:"string",pinLayout:i.RIGHT_PIN,contentType:"string",data:{value:""}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Ut=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Split,100,{x:0,y:0},{0:{name:"out",pinLayout:i.RIGHT_PIN,contentType:"none",data:{}},1:{name:"input",pinLayout:i.LEFT_PIN,contentType:"string",data:{value:""}},2:{name:"separator",pinLayout:i.LEFT_PIN,contentType:"string",data:{value:"",height:"20px"}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value,e="2"in t?t[2][0]:this.connectors[2].data.value;return{0:e[0]?n.split(e[0]):n}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Ht=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.call(this,ft.Operation,160,{x:0,y:0},{0:{name:"output",pinLayout:i.RIGHT_PIN,contentType:"number",data:{value:0,disabled:!0}},1:{name:"type",pinLayout:i.NO_PINS,contentType:"select",data:{values:["add","substract","multiply","divide","modulo"],selected_index:0}},2:{name:"x",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},3:{name:"y",pinLayout:i.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}}})}return Object(jt.a)(e,[{key:"computeSpecific",value:function(t,n,e){var o=Number("2"in t?t[2][0]:this.connectors[2].data.value),i=Number("3"in t?t[3][0]:this.connectors[3].data.value),r=0;switch(this.connectors[1].data.selected_index){case 0:r=o+i;break;case 1:r=o-i;break;case 2:r=o*i;break;case 3:r=isNaN(o/i)?0:o/i;break;case 4:r=isNaN(o%i)?0:o%i}return e((function(e){return Object(l.a)(e,(function(e){e[n].connectors[0].data.value=r,e[n].connectors[2].data.disabled="2"in t,e[n].connectors[2].data.value=o,e[n].connectors[3].data.disabled="3"in t,e[n].connectors[3].data.value=i}))})),{0:r}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n}}]),e}(wt),Jt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){var t;return Object(kt.a)(this,e),(t=n.call(this,ft.Log,100,{x:0,y:0},{0:{name:"log",pinLayout:i.LEFT_PIN,contentType:"none",data:{},leftPinColor:"red"},1:{name:"log",pinLayout:i.NO_PINS,contentType:"button",data:{label:"log"}}})).inputs=void 0,t.inputs=[],t.connectors[1].data.onClick=t.log,t}return Object(jt.a)(e,[{key:"log",value:function(t){t.inputs.forEach((function(t){console.log(t)}))}},{key:"computeSpecific",value:function(t,n,e){return t[0]&&!d.a.isEqual(t[0],this.inputs)&&e((function(e){return Object(l.a)(e,(function(e){e[n].inputs=t[0]}))})),{}}}],[{key:"createFromJson",value:function(t){var n=new e;return wt.initFromJson(t,n),n.connectors[1].data.onClick=n.log,n}}]),e}(wt);var Dt=e(3),Zt=e(10),At=function(t){var n=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=t.nodeId,o=t.cId,i=t.connector,r=t.onConnectorUpdate;if(n.current){var a=n.current.getContext("2d");if(a&&(!("canvas_ctx"in i.data)||a!==i.data.canvas_ctx))r(e,o,Object(l.a)(i,(function(t){t.data.canvas_ctx=a})))}}),[n,t]),Object(Zt.jsx)("canvas",{style:{border:"1px solid black"},width:t.connector.data.canvas_width,height:t.connector.data.canvas_height,ref:n})},Gt=e(26),Bt=e(97),Vt=function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(t){var o;return Object(kt.a)(this,e),(o=n.call(this,t)).onColorChange=o.onColorChange.bind(Object(Gt.a)(o)),o}return Object(jt.a)(e,[{key:"onColorChange",value:function(t){var n=this.props,e=n.nodeId,o=n.cId,i=n.connector;(0,n.onConnectorUpdate)(e,o,Object(l.a)(i,(function(n){n.data.color="rgba(".concat(t.rgb.r,", ").concat(t.rgb.g,", ").concat(t.rgb.b,", ").concat(t.rgb.a,")")})))}},{key:"render",value:function(){var t=this.props.connector;if(!("color"in t.data)){return Object(Zt.jsx)(H,{message:"'color' connector types must provide a string field named 'color'"})}return Object(Zt.jsx)(Bt.a,{color:t.data.color,onChange:this.onColorChange})}}]),e}(r.Component),qt=e(98),Xt=(e(216),function(t){Object(It.a)(e,t);var n=Object(Et.a)(e);function e(){return Object(kt.a)(this,e),n.apply(this,arguments)}return Object(jt.a)(e,[{key:"render",value:function(){return Object(Zt.jsxs)(Zt.Fragment,{children:["ICI",Object(Zt.jsx)(qt.a,{onChange:function(t){console.log(t)}})]})}}]),e}(r.Component)),Yt=Xt;function Kt(t){var n=t.connector;return"color"===n.contentType?Object(Zt.jsx)(Vt,Object(Dt.a)({},t)):"slider"===n.contentType?Object(Zt.jsx)(Yt,Object(Dt.a)({},t)):"canvas"===n.contentType?Object(Zt.jsx)(At,Object(Dt.a)({},t)):null}var Wt=function(){var t=a.a.useState(null),n=Object(u.a)(t,2),e=n[0],o=n[1],i=a.a.useState(!1),r=Object(u.a)(i,2),c=r[0],s=r[1],p=a.a.useState({zoom:1,topLeftCorner:{x:0,y:0}}),v=Object(u.a)(p,2),h=v[0],f=v[1],m=a.a.useState([]),b=Object(u.a)(m,2),g=b[0],P=b[1],O=localStorage.getItem("nodes"),x=localStorage.getItem("links"),C=O?JSON.parse(O):{},k=x?JSON.parse(x):{};O&&Object.keys(C).forEach((function(t){C[t]=function(t){var n=void 0;switch(t.name){case ft.Canvas:n=_t.createFromJson(t);break;case ft.Color:n=Tt.createFromJson(t);break;case ft.Number:n=St.createFromJson(t);break;case ft.Rectangle:n=Nt.createFromJson(t);break;case ft.Rotate:n=Lt.createFromJson(t);break;case ft.Timer:n=Mt.createFromJson(t);break;case ft.Translate:n=zt.createFromJson(t);break;case ft.IfElse:n=Ft.createFromJson(t);break;case ft.String:n=Rt.createFromJson(t);break;case ft.Split:n=Ut.createFromJson(t);break;case ft.Operation:n=Ht.createFromJson(t);break;case ft.Log:n=Jt.createFromJson(t)}if(!n)throw new Error("Error while reading node from json");return n}(C[t])}));var j=a.a.useState(C),w=Object(u.a)(j,2),I=w[0],E=w[1],_=a.a.useState(k),N=Object(u.a)(_,2),L=N[0],S=N[1];localStorage.setItem("nodes",JSON.stringify(I)),localStorage.setItem("links",JSON.stringify(L));var T={0:new _t,1:new Nt,2:new Lt,3:new St,4:new Mt,5:new Tt,6:new zt,7:new Ft,8:new Rt,9:new Ut,10:new Ht,11:new Jt};a.a.useEffect((function(){Object.keys(I).forEach((function(t){var n=I[t];if(n instanceof _t||n instanceof Jt)try{n.compute(I,L,E)}catch(e){console.error(e)}}))}),[I,L]),a.a.useEffect((function(){var t=setInterval((function(){var t=!1,n=Object(l.c)(I,(function(n){for(var e=0,o=Object.keys(I);e<o.length;e++){var i=o[e];"timer"===n[i].name&&n[i].connectors[1].data.value&&(n[i].connectors[0].data.value=(Number(n[i].connectors[0].data.value)+1).toString(),t=!0)}}));t&&E(n)}),1e3/60);return function(){return clearInterval(t)}}),[I,L]);var M=a.a.useCallback((function(t,n,e,o){E((function(i){return Object(l.c)(i,(function(i){i[t].position={x:n,y:e},i[t].width=o}))}))}),[]),z=a.a.useCallback((function(t){S((function(n){return Object(l.c)(n,(function(n){n[y()]=t}))}))}),[]),F=a.a.useCallback((function(){var t=g.filter((function(t){return"node"===t.type})).map((function(t){return t.id})),n=g.filter((function(t){return"link"===t.type})).map((function(t){return t.id}));E((function(n){return Object(l.c)(n,(function(n){t.forEach((function(t){delete n[t]}))}))})),S((function(e){return Object(l.c)(e,(function(o){Object.keys(e).forEach((function(n){var i=e[n];(t.includes(i.inputNodeId)||t.includes(i.outputNodeId))&&delete o[n]})),n.forEach((function(t){delete o[t]}))}))}))}),[g]),R=a.a.useCallback((function(t){e&&(E((function(n){return Object(l.c)(n,(function(n){var o=d.a.clone(T[t]),i=-h.topLeftCorner.x/h.zoom+e.x/h.zoom,r=-h.topLeftCorner.y/h.zoom+e.y/h.zoom;o.position={x:i,y:r},n[y()]=o}))})),s(!1),o(null))}),[h,e,T]),U=a.a.useCallback((function(t,n,e){E((function(o){return Object(l.c)(o,(function(o){o[t].connectors[n]=e}))}))}),[]),H=a.a.useCallback((function(t){t.preventDefault(),e?(s(!1),o(null)):o({x:t.pageX,y:t.pageY})}),[e]),J=a.a.useCallback((function(){e&&!c&&(s(!1),o(null))}),[c,e,o]),D=null;return e&&0===g.length?D=Object(Zt.jsx)("div",{style:{width:640,height:500,position:"absolute",top:e.y,left:e.x,backgroundColor:"white"},children:Object(Zt.jsx)(xt,{nodesSchema:T,onNodeSelection:R,onMouseHover:s,createCustomConnectorComponent:Kt})}):e&&(D=Object(Zt.jsx)("div",{style:{width:640,height:480,position:"absolute",top:e.y,left:e.x,backgroundColor:"white"},children:Object(Zt.jsx)(Ct,{onMouseHover:s,onDeleteSelection:F})})),Object(Zt.jsx)(Zt.Fragment,{children:Object(Zt.jsxs)("div",{style:{width:"100%",height:"100%"},onContextMenu:H,onMouseDown:J,tabIndex:0,children:[Object(Zt.jsx)(mt,{panZoomInfo:h,nodes:I,links:L,selectedItems:g,onPanZoomInfo:f,onSelectedItems:P,onNodeMove:M,onCreateLink:z,onConnectorUpdate:U,createCustomConnectorComponent:Kt}),D]})})},Qt=function(){return Object(Zt.jsx)("div",{style:{width:"100%",height:"100vh"},className:"App",children:Object(Zt.jsx)(Wt,{})})};s.a.render(Object(Zt.jsx)(a.a.StrictMode,{children:Object(Zt.jsx)(Qt,{})}),document.getElementById("root"))}},[[217,1,2]]]);
//# sourceMappingURL=main.d6e9c939.chunk.js.map
(this["webpackJsonpoura-canvas-creator"]=this["webpackJsonpoura-canvas-creator"]||[]).push([[0],{32:function(t,e,n){},37:function(t,e,n){"use strict";n.r(e);var o,a,i=n(4),r=n.n(i),c=n(23),u=(n(32),n(15)),s=n(13),l=n(6),d=n(12),p=n(9),v=n.n(p);function h(t,e){return t.x===e.x&&t.y===e.y}function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT"}(o||(o={})),function(t){t[t.NO_PINS=0]="NO_PINS",t[t.LEFT_PIN=1]="LEFT_PIN",t[t.RIGHT_PIN=2]="RIGHT_PIN",t[t.BOTH_PINS=3]="BOTH_PINS"}(a||(a={}));var m=n(22),y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(e){var n=t.call(this,e)||this;return n.panStartPosition=null,n.shiftKey=!1,n.state={panDisabled:!1},n.onMouseDown=n.onMouseDown.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n.onZoomChange=n.onZoomChange.bind(n),n.onPanning=n.onPanning.bind(n),n.onPanningStart=n.onPanningStart.bind(n),n.onPanningStop=n.onPanningStop.bind(n),n}return y(e,t),e.prototype.onMouseDown=function(t){this.shiftKey=t.shiftKey;var e=t.target,n=!1;"string"===typeof e.id&&(n="link_canvas"===e.id);var o=!1;"string"===typeof e.className&&(o=e.className.includes("react-transform-wrapper")),this.setState({panDisabled:0!==t.button||!n&&!o})},e.prototype.onMouseUp=function(){this.setState({panDisabled:!1})},e.prototype.onZoomChange=function(t){(0,this.props.onPanZoomInfo)({zoom:t.state.scale,topLeftCorner:{x:t.state.positionX,y:t.state.positionY}})},e.prototype.onPanning=function(t){(0,this.props.onPanZoomInfo)({zoom:t.state.scale,topLeftCorner:{x:t.state.positionX,y:t.state.positionY}})},e.prototype.onPanningStart=function(t){this.panStartPosition={x:t.state.positionX,y:t.state.positionY}},e.prototype.onPanningStop=function(t){var e=this.props.onSelectItem,n=t.state.positionX,o=t.state.positionY;this.panStartPosition&&this.panStartPosition.x===n&&this.panStartPosition.y===o&&e(null,this.shiftKey)},e.prototype.render=function(){var t=this.props,e=t.panZoomInfo,n=t.children,o=this.state.panDisabled;return i.createElement("div",{id:"panzoom",style:{position:"relative",width:"100%",height:"100%"},onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp},i.createElement(m.b,{limitToBounds:!1,minScale:.35,panning:{excluded:["input","select","textarea","button","path"],disabled:o,velocityDisabled:!0},doubleClick:{disabled:!0},wheel:{step:.1},onWheel:this.onZoomChange,onPanningStart:this.onPanningStart,onPanning:this.onPanning,onPanningStop:this.onPanningStop,initialScale:e.zoom,initialPositionX:e.topLeftCorner.x,initialPositionY:e.topLeftCorner.y},i.createElement(m.a,null,i.createElement("div",{style:{height:"100vh",width:"100vw"}},n))))},e}(i.Component);var g={theme:{node:{selected:{boxShadow:"0px 0px 0px 2px white",borderRadius:"10px 10px 10px 10px"},header:{backgroundColor:"orange",color:"white",borderRadius:"10px 10px 0px 0px",height:"20px",cursor:"grab",overflow:"hidden",paddingLeft:"10px"},body:{color:"white",backgroundColor:"rgba(63, 63, 63, 0.75)",cursor:"grab"},footer:{borderRadius:"0px 0px 10px 10px",height:"10px",backgroundColor:"rgba(63, 63, 63, 0.75)",cursor:"ew-resize"},basePin:{backgroundColor:"rgba(199, 199, 41, 1)",borderRadius:"5px 5px 5px 5px",cursor:"grab"},customPins:{string:{backgroundColor:"red",transform:"rotate(45deg)"}}},link:{selected:{stroke:"white",strokeWidth:"3px",fill:"none"},unselected:{stroke:"rgba(170, 170, 170, 0.75)",strokeWidth:"3px",fill:"none"}},connectors:{leftText:{width:"40%",textOverflow:"ellipsis",overflow:"hidden"},string:{width:"100%",backgroundColor:"#585858",color:"white",border:0,outline:"none"},number:{width:"60%",boxSizing:"border-box",backgroundColor:"#585858",color:"white",border:0,outline:"none",textAlign:"right",borderRadius:"8px",paddingRight:"5px"},select:{width:"60%",backgroundColor:"#585858",boxSizing:"border-box",color:"white",border:0,outline:"none",textAlign:"right",borderRadius:"8px",paddingRight:"5px"},button:{width:"100%",backgroundColor:"#585858",color:"white",border:0,outline:"none"}}},buildBackgroundStyle:function(t){var e=String(200*t.zoom);return{backgroundColor:"#232323",backgroundPosition:"".concat(t.topLeftCorner.x,"px ").concat(t.topLeftCorner.y,"px"),backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='".concat(e,"' height='").concat(e,"' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='black' fill-opacity='0.4'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")")}}},O=Object(i.createContext)(g),P=function(){return P=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},P.apply(this,arguments)};function k(t){var e=Object(i.useContext)(O).buildBackgroundStyle,n=t.panZoomInfo,o=t.children,a={position:"relative",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"};return e&&(a=P(P({},a),e(n))),r.a.createElement("div",{style:a},o)}var j=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(){return x=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},x.apply(this,arguments)},I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.shouldComponentUpdate=function(t){return!p.isEqual(this.props,t)},e.prototype.onSelectLink=function(t){var e=this.props,n=e.linkId,o=e.onSelectLink;o&&n&&o(n,t.shiftKey)},e.prototype.render=function(){var t,e,n,o,a,i,c=this.context.theme,u=this.props,s=u.linkId,l=u.linkPosition,d=u.isLinkSelected,p=l.inputPinPosition.x,v=l.inputPinPosition.y,h=l.outputPinPosition.x,f=l.outputPinPosition.y,m=function(t,e){var n=Math.abs(e.x-t.x)/2,o=e.x<t.x?e.x+n:e.x-n,a=Math.abs(e.y-t.y)/2;return{x:o,y:e.y<t.y?e.y+a:e.y-a}}(l.inputPinPosition,l.outputPinPosition),y="M".concat(p,",").concat(v," C").concat(m.x,",").concat(v," ").concat(m.x,",").concat(f," ").concat(h,",").concat(f),b=d?x(x({},null===(t=null===c||void 0===c?void 0:c.link)||void 0===t?void 0:t.selected),null===(n=null===(e=this.props.link)||void 0===e?void 0:e.theme)||void 0===n?void 0:n.selected):x(x({},null===(o=null===c||void 0===c?void 0:c.link)||void 0===o?void 0:o.unselected),null===(i=null===(a=this.props.link)||void 0===a?void 0:a.theme)||void 0===i?void 0:i.unselected);return r.a.createElement("path",{id:"link_".concat(s),d:y,style:b,onClick:this.onSelectLink.bind(this)})},e}(i.Component),C=I;I.contextType=O;var w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),N=function(){return N=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},N.apply(this,arguments)},E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return w(e,t),e.prototype.shouldComponentUpdate=function(t){return!p.isEqual(this.props,t)},e.prototype.onSelectLink=function(t){var e=this.props,n=e.linkId,o=e.onSelectLink;o&&n&&o(n,t.shiftKey)},e.prototype.render=function(){var t,e,n,o,a,i,c=this.context.theme,u=this.props,s=u.linkId,l=u.linkPosition,d=u.isLinkSelected?N(N({},null===(t=null===c||void 0===c?void 0:c.link)||void 0===t?void 0:t.selected),null===(n=null===(e=this.props.link)||void 0===e?void 0:e.theme)||void 0===n?void 0:n.selected):N(N({},null===(o=null===c||void 0===c?void 0:c.link)||void 0===o?void 0:o.unselected),null===(i=null===(a=this.props.link)||void 0===a?void 0:a.theme)||void 0===i?void 0:i.unselected);return r.a.createElement("line",{id:"link_".concat(s),x1:l.inputPinPosition.x,y1:l.inputPinPosition.y,x2:l.outputPinPosition.x,y2:l.outputPinPosition.y,style:d,onClick:this.onSelectLink.bind(this)})},e}(i.Component),_=E;E.contextType=O;var T=function(){return T=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},T.apply(this,arguments)};function L(t){var e=t.link;return"line"===(null===e||void 0===e?void 0:e.linkType)?r.a.createElement(_,T({},t)):r.a.createElement(C,T({},t))}function S(t){var e=t.links,n=t.linksPositions,o=t.selectedItems,a=t.draggedLink,i=t.onSelectItem;return r.a.createElement("svg",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"visible"},id:"link_canvas"},Object.keys(e).filter((function(t){return t in n})).map((function(t){return L({linkId:t,link:e[t],key:t,linkPosition:n[t],isLinkSelected:v.a.some(o,{id:t,type:"link"}),onSelectLink:function(t,e){return i({id:t,type:"link"},e)}})})),a&&L({linkPosition:a,isLinkSelected:!1}))}var F=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return F(e,t),e.prototype.shouldComponentUpdate=function(t){return!p.isEqual(this.props,t)},e.prototype.render=function(){var t=this.props.connector;return r.a.createElement("div",{className:"node-background",style:{textAlign:t.pinLayout===a.RIGHT_PIN?"right":"left"}},t.name)},e}(i.Component),R=M,z=function(t){var e=t.message;return r.a.createElement("div",{style:{color:"red"}},"error: ".concat(e))},J=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),U=function(t){function e(e){var n=t.call(this,e)||this;return n.onChange=n.onChange.bind(n),n}return J(e,t),e.prototype.onChange=function(){var t=this.props,e=t.nodeId,n=t.cId,o=t.connector;(0,t.onConnectorUpdate)(e,n,Object(d.a)(o,(function(t){t.data.value=!t.data.value})))},e.prototype.render=function(){var t=this.props.connector;if(!("value"in t.data)){return r.a.createElement(z,{message:"'check_box' connector types must provide a bool field named 'value'"})}return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{tabIndex:-1,checked:t.data.value,onChange:this.onChange,type:"checkbox",style:{backgroundColor:"#585858",color:"white",border:0,outline:"none"}}),t.name)},e}(i.Component),H=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),D=function(t){function e(e){var n=t.call(this,e)||this;return n.onChange=n.onChange.bind(n),n}return H(e,t),e.prototype.shouldComponentUpdate=function(t){return!v.a.isEqual(this.props,t)},e.prototype.onChange=function(t){var e=this.props,n=e.nodeId,o=e.cId,a=e.connector,i=e.onConnectorUpdate;isNaN(Number(t.currentTarget.value))||i(n,o,Object(d.a)(a,(function(e){e.data.value=t.currentTarget.value})))},e.prototype.render=function(){var t,e,n=this.context.theme,o=this.props.connector;if(!("value"in o.data)){return r.a.createElement(z,{message:"'number' connector types must provide a string field named 'value'"})}return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{className:"node-background",style:null===(t=null===n||void 0===n?void 0:n.connectors)||void 0===t?void 0:t.leftText},o.name),r.a.createElement("input",{disabled:"disabled"in o.data&&o.data.disabled,style:null===(e=null===n||void 0===n?void 0:n.connectors)||void 0===e?void 0:e.number,value:o.data.value,onChange:this.onChange,placeholder:o.name}))},e}(i.Component),A=D;D.contextType=O;var Z=function(t){var e,n,o=t.connector,a=t.nodeId,c=t.cId,u=t.onConnectorUpdate,s=Object(i.useContext)(O).theme;if(!("values"in o.data)||!("selected_index"in o.data)){return r.a.createElement(z,{message:"'select' connector types must provide a string array field named 'values' and a number field 'selected_index'"})}var l=Object(i.useCallback)((function(t){var e=Object(d.a)(o,(function(e){e.data.selected_index=t}));u(a,c,e)}),[u,a,c,o]);return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{className:"node-background",style:null===(e=null===s||void 0===s?void 0:s.connectors)||void 0===e?void 0:e.leftText},o.name),r.a.createElement("select",{onChange:function(t){return l(t.target.selectedIndex)},style:null===(n=null===s||void 0===s?void 0:s.connectors)||void 0===n?void 0:n.select,defaultValue:o.data.values[o.data.selected_index]},o.data.values.map((function(t){return r.a.createElement("option",{key:t,value:t},t)}))))},G=function(t){var e,n=t.connector,o=t.node,a=Object(i.useContext)(O).theme;if(!("label"in n.data)||!("onClick"in n.data)){return r.a.createElement(z,{message:"'button' connector types must provide a string field named 'label' and a callback 'onClick'"})}return r.a.createElement("button",{style:null===(e=null===a||void 0===a?void 0:a.connectors)||void 0===e?void 0:e.button,onClick:function(){return n.data.onClick(o)}},n.data.label)},B=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),W=function(){return W=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},W.apply(this,arguments)},V=function(t){function e(e){var n=t.call(this,e)||this;return n.textAreaRef=r.a.createRef(),n.onChange=n.onChange.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n}return B(e,t),e.prototype.shouldComponentUpdate=function(t){return!v.a.isEqual(this.props,t)},e.prototype.onChange=function(t){var e=this.props,n=e.nodeId,o=e.cId,a=e.connector;(0,e.onConnectorUpdate)(n,o,Object(d.a)(a,(function(e){e.data.value=t.currentTarget.value})))},e.prototype.onMouseUp=function(){if(this.textAreaRef.current){var t=this.props,e=t.nodeId,n=t.cId,o=t.connector,a=t.onConnectorUpdate,i=this.textAreaRef.current.style.height;a(e,n,Object(d.a)(o,(function(t){t.data.height=i})))}},e.prototype.render=function(){var t,e=this.context.theme,n=this.props.connector;if(!("value"in n.data)){return r.a.createElement(z,{message:"'text_area' connector types must provide a string field named 'value'"})}var o="height"in n.data?n.data.height:100;return r.a.createElement("textarea",{ref:this.textAreaRef,style:W({height:o,whiteSpace:"pre",resize:"vertical"},null===(t=null===e||void 0===e?void 0:e.connectors)||void 0===t?void 0:t.string),value:n.data.value,onChange:this.onChange,onMouseUp:this.onMouseUp,placeholder:n.name})},e}(i.Component),q=V;V.contextType=O;var X=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Y=function(t){function e(e){var n=t.call(this,e)||this;return n.onChange=n.onChange.bind(n),n}return X(e,t),e.prototype.shouldComponentUpdate=function(t){return!v.a.isEqual(this.props,t)},e.prototype.onChange=function(t){var e=this.props,n=e.nodeId,o=e.cId,a=e.connector;(0,e.onConnectorUpdate)(n,o,Object(d.a)(a,(function(e){e.data.value=t.currentTarget.value})))},e.prototype.render=function(){var t,e,n=this.context.theme,o=this.props.connector;if(!("value"in o.data)){return r.a.createElement(z,{message:"'string' connector types must provide a string field named 'value'"})}return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{className:"node-background",style:null===(t=null===n||void 0===n?void 0:n.connectors)||void 0===t?void 0:t.leftText},o.name),r.a.createElement("input",{disabled:"disabled"in o.data&&o.data.disabled,style:null===(e=null===n||void 0===n?void 0:n.connectors)||void 0===e?void 0:e.number,value:o.data.value,onChange:this.onChange,placeholder:o.name}))},e}(i.Component),K=Y;Y.contextType=O;var Q=function(){return Q=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},Q.apply(this,arguments)};var $=function(){return $=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},$.apply(this,arguments)},tt=function(){function t(){this.onMouseMoveCb=function(){return null},this.onMouseUpCb=function(){return null},this.initialPos={x:0,y:0},this.finalPos={x:0,y:0},this.tmpPos={x:0,y:0},this.getZoom=function(){return 1},this.targetClassName="",this.lastZoom=0,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this)}return t.prototype.onMouseDown=function(t,e,n,o,a){window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),this.getZoom=n,this.initialPos=e,this.finalPos={x:e.x,y:e.y};var i=n();this.lastZoom=i,this.tmpPos={x:t.pageX/i,y:t.pageY/i},this.onMouseMoveCb=o,this.onMouseUpCb=a},t.prototype.onMouseMove=function(t){var e=this.getZoom(),n={x:t.pageX/this.lastZoom-this.tmpPos.x,y:t.pageY/this.lastZoom-this.tmpPos.y};this.finalPos.x+=n.x,this.finalPos.y+=n.y,this.tmpPos={x:t.pageX/e,y:t.pageY/e};var o=t.target.className;"string"===typeof o&&(this.targetClassName=o),this.onMouseMoveCb($({},this.initialPos),$({},this.finalPos),n,this.targetClassName),this.lastZoom=e},t.prototype.onMouseUp=function(t){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),this.onMouseUpCb($({},this.initialPos),$({},this.finalPos),t)},t}(),et=function(){return et=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},et.apply(this,arguments)},nt=function(t){var e,n,o,a,c=t.className,u=t.contentType,s=t.leftPinPosition,l=t.pinPxRadius,d=t.pinColor,p=t.onMouseDown,v=Object(i.useContext)(O).theme,h=void 0;(null===(e=null===v||void 0===v?void 0:v.node)||void 0===e?void 0:e.customPins)&&(null===(n=null===v||void 0===v?void 0:v.node)||void 0===n?void 0:n.customPins[u])&&(h=null===(o=null===v||void 0===v?void 0:v.node)||void 0===o?void 0:o.customPins[u]);var f=et(et({position:"absolute",width:"".concat(2*l,"px"),height:"".concat(2*l,"px"),left:"".concat(s,"px"),top:"calc(50% - ".concat(l,"px)")},null===(a=null===v||void 0===v?void 0:v.node)||void 0===a?void 0:a.basePin),h);return d&&(f.backgroundColor=d),r.a.createElement("div",{className:c,style:f,onMouseDown:p})},ot=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),at=function(t){function e(e){var n=t.call(this,e)||this;return n.dragWrapper=new tt,n.connectorRef=r.a.createRef(),n.leftPinPos=null,n.rightPinPos=null,n.pinPxRadius=6,n.onMouseDown=n.onMouseDown.bind(n),n.onPinPositionUpdate=n.onPinPositionUpdate.bind(n),n}return ot(e,t),e.prototype.componentDidMount=function(){this.onPinPositionUpdate()},e.prototype.componentDidUpdate=function(){this.onPinPositionUpdate()},e.prototype.onPinPositionUpdate=function(){var t=this.props,e=t.cId,n=t.onPinPositionUpdate,a=this.getConnectorPinPosition(o.LEFT),i=this.getConnectorPinPosition(o.RIGHT);v.a.isEqual(a,this.leftPinPos)&&v.a.isEqual(i,this.rightPinPos)||(this.leftPinPos=a,this.leftPinPos=i,n(e,a,i))},e.prototype.onMouseDown=function(t,e){var n=this.props,a=n.nodeId,i=n.cId,r=n.getZoom,c=n.onUpdatePreviewLink,u=n.onCreateLink,s=this.getConnectorPinPosition(t);if(s&&c&&u){this.dragWrapper.onMouseDown(e,s,r,(function(t,e){c({linkId:"preview",outputPinPosition:e,inputPinPosition:t})}),(function(t,e,n){var r=null;n.target&&("string"===typeof n.target.className&&(r=n.target.className.match(/node-(.+)-connector-(.+)-(left|right)/)));null!==r&&"left"===r[3]?u({inputNodeId:r[1],inputPinId:r[2],inputPinSide:o.LEFT,outputNodeId:a,outputPinId:i,outputPinSide:o.RIGHT}):null!==r&&u({inputNodeId:a,inputPinId:i,inputPinSide:o.LEFT,outputNodeId:r[1],outputPinId:r[2],outputPinSide:o.RIGHT,linkType:"bezier"}),c(void 0)}))}},e.prototype.getConnectorPinPosition=function(t){var e=this.props,n=e.connector,i=e.node,r=this.connectorRef.current;return!r||n.pinLayout===a.NO_PINS||t===o.LEFT&&n.pinLayout===a.RIGHT_PIN||t===o.RIGHT&&n.pinLayout===a.LEFT_PIN?null:{x:t===o.RIGHT?i.width+i.position.x:i.position.x,y:i.position.y+r.offsetTop+r.offsetHeight/2}},e.prototype.render=function(){var t=this,e=this.props,n=e.connector,i=e.node,c=e.nodeId,u=e.cId,s=e.createCustomConnectorComponent,l=null;return s&&(l=s(this.props)),l||(l=function(t){var e=t.connector;return"string"===e.contentType?r.a.createElement(K,Q({},t)):"text_area"===e.contentType?r.a.createElement(q,Q({},t)):"number"===e.contentType?r.a.createElement(A,Q({},t)):"check_box"===e.contentType?r.a.createElement(U,Q({},t)):"select"===e.contentType?r.a.createElement(Z,Q({},t)):"button"===e.contentType?r.a.createElement(G,Q({},t)):r.a.createElement(R,Q({},t))}(this.props)),r.a.createElement("div",{className:"node-background",ref:this.connectorRef,style:{position:"relative",paddingTop:3}},[a.LEFT_PIN,a.BOTH_PINS].includes(n.pinLayout)&&r.a.createElement(nt,{className:"node-".concat(c,"-connector-").concat(u,"-left"),contentType:n.contentType,pinPxRadius:this.pinPxRadius,leftPinPosition:-this.pinPxRadius,onMouseDown:function(e){return t.onMouseDown(o.LEFT,e)},pinColor:this.props.connector.leftPinColor}),[a.RIGHT_PIN,a.BOTH_PINS].includes(n.pinLayout)&&r.a.createElement(nt,{className:"node-".concat(c,"-connector-").concat(u,"-right"),contentType:n.contentType,pinPxRadius:this.pinPxRadius,leftPinPosition:i.width-this.pinPxRadius,onMouseDown:function(e){return t.onMouseDown(o.RIGHT,e)},pinColor:this.props.connector.rightPinColor}),r.a.createElement("div",{className:"node-background",style:{overflow:"hidden",paddingLeft:2*this.pinPxRadius,paddingRight:2*this.pinPxRadius}},l))},e}(i.Component),it=function(){return it=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},it.apply(this,arguments)};function rt(t){var e,n,o=t.node,a=Object(i.useContext)(O).theme;return r.a.createElement("div",{className:"node-background node-header",style:it(it({},null===(e=a.node)||void 0===e?void 0:e.header),null===(n=o.theme)||void 0===n?void 0:n.header)},o.name)}var ct=function(){return ct=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},ct.apply(this,arguments)};function ut(t){var e,n,o=t.node,a=Object(i.useContext)(O).theme;return r.a.createElement("div",{className:"node-background node-footer",style:ct(ct({},null===(e=null===a||void 0===a?void 0:a.node)||void 0===e?void 0:e.footer),null===(n=null===o||void 0===o?void 0:o.theme)||void 0===n?void 0:n.footer)})}var st=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),lt=function(){return lt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},lt.apply(this,arguments)},dt=function(t){function e(e){var n=t.call(this,e)||this;return n.dragWrapper=new tt,n.pinPositions={},n.onMouseDown=n.onMouseDown.bind(n),n.onPinPositionUpdate=n.onPinPositionUpdate.bind(n),n}return st(e,t),e.prototype.shouldComponentUpdate=function(t){var e=this.props,n=e.node;return e.isNodeSelected!==t.isNodeSelected||!v.a.isEqual(n,t.node)},e.prototype.onMouseDown=function(t){var e=this.props,n=e.nodeId,o=e.getZoom,a=e.onNodeMoveStart,i=e.onNodeMove,r=e.onNodeMoveEnd;if(a&&i&&r){var c=!0,u="";if(t.target){var s=t.target.className;"string"===typeof s&&s.includes("node-background")&&(u=s,c=!1)}if(!c){a(n,t.shiftKey);var l=o(),d={x:t.pageX/l,y:t.pageY/l};this.dragWrapper.onMouseDown(t,d,o,(function(t,e,n){u.includes("node-footer")?i(0,0,n.x):i(n.x,n.y,0)}),(function(t,e,o){r(n,!h(t,e),o.shiftKey)}))}}},e.prototype.onPinPositionUpdate=function(t,e,n){var o=this.props,i=o.nodeId,r=o.node,c=o.onNodePinPositionsUpdate;this.pinPositions[t]=[e,n];var u=Object.keys(r.connectors).filter((function(t){return r.connectors[t].pinLayout!==a.NO_PINS})).length;Object.keys(this.pinPositions).length===u&&c(i,this.pinPositions)},e.prototype.render=function(){var t,e,n,o,a,i,c=this,u=this.context.theme,s=this.props,l=s.nodeId,d=s.node,p=s.isNodeSelected,v=this.props,h=v.onCreateLink,f=v.onUpdatePreviewLink,m=v.getZoom,y=v.onConnectorUpdate,b=this.props.createCustomConnectorComponent,g={position:"absolute",width:"".concat(d.width,"px"),top:"".concat(d.position.y,"px"),left:"".concat(d.position.x,"px")},O=p?lt(lt({},null===(t=null===u||void 0===u?void 0:u.node)||void 0===t?void 0:t.selected),null===(e=null===d||void 0===d?void 0:d.theme)||void 0===e?void 0:e.selected):lt(lt({},null===(n=null===u||void 0===u?void 0:u.node)||void 0===n?void 0:n.unselected),null===(o=null===d||void 0===d?void 0:d.theme)||void 0===o?void 0:o.unselected);return r.a.createElement("div",{className:"node-background",style:lt(lt({},g),O),onMouseDown:this.onMouseDown,id:"node_".concat(l)},r.a.createElement(rt,{node:d}),r.a.createElement("div",{style:lt(lt({},null===(a=null===u||void 0===u?void 0:u.node)||void 0===a?void 0:a.body),null===(i=null===d||void 0===d?void 0:d.theme)||void 0===i?void 0:i.body)},Object.keys(d.connectors).map((function(t){return r.a.createElement(at,{nodeId:l,cId:t,getZoom:m,node:d,key:t,connector:d.connectors[t],onCreateLink:h,onUpdatePreviewLink:f,onConnectorUpdate:y,onPinPositionUpdate:c.onPinPositionUpdate,createCustomConnectorComponent:b})}))),r.a.createElement(ut,{node:d}))},e}(i.Component);dt.contextType=O;var pt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),vt=function(t){function e(e){var n=t.call(this,e)||this;return n.onNodeMoveStart=n.onNodeMoveStart.bind(n),n.onNodeMove=n.onNodeMove.bind(n),n.onNodeMoveEnd=n.onNodeMoveEnd.bind(n),n}return pt(e,t),e.prototype.onNodeMoveStart=function(t,e){var n=this,o=this.props,a=o.selectedItems,i=o.onSelectItem,r={id:t,type:"node"},c=!1;a.forEach((function(t){t.id===r.id&&t.type===r.type&&(c=!0)})),c||(this.lastSettedSelection=r,a.forEach((function(e){e.id===t&&"node"===e.type&&(n.lastSettedSelection=void 0)})),e&&this.lastSettedSelection&&i(r,e),e||i(r,e))},e.prototype.onNodeMove=function(t,e,n){var o=this;this.props.selectedItems.forEach((function(a){if("node"===a.type){var i=o.props,r=i.nodes,c=i.onNodeMove,u=r[a.id].position.x+t,s=r[a.id].position.y+e,l=r[a.id].width+n;c(a.id,u,s,l>100?l:100)}}))},e.prototype.onNodeMoveEnd=function(t,e,n){var o=this.props.onSelectItem,a={id:t,type:"node"};(e||n)&&(e||!n||v.a.isEqual(a,this.lastSettedSelection))||o(a,n),this.lastSettedSelection=void 0},e.prototype.render=function(){var t=this,e=this.props,n=e.nodes,o=e.selectedItems,a=this.props,i=a.getZoom,c=a.onCreateLink,u=a.onUpdatePreviewLink,s=a.onNodePinPositionsUpdate,l=this.props,d=l.onConnectorUpdate,p=l.createCustomConnectorComponent;return r.a.createElement(r.a.Fragment,null,Object.keys(n).map((function(e){return r.a.createElement(dt,{nodeId:e,key:e,node:n[e],isNodeSelected:v.a.some(o,{id:e,type:"node"}),getZoom:i,onNodeMoveStart:t.onNodeMoveStart,onNodeMove:t.onNodeMove,onNodeMoveEnd:t.onNodeMoveEnd,onCreateLink:c,onUpdatePreviewLink:u,onNodePinPositionsUpdate:s,onConnectorUpdate:d,createCustomConnectorComponent:p})})))},e}(r.a.Component),ht=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ft=function(t,e,n){if(n||2===arguments.length)for(var o,a=0,i=e.length;a<i;a++)!o&&a in e||(o||(o=Array.prototype.slice.call(e,0,a)),o[a]=e[a]);return t.concat(o||Array.prototype.slice.call(e))};Object(d.b)();var mt,yt=function(t){function e(e){var n=t.call(this,e)||this;return n.nodesPinPositions={},n.mainDivRef=r.a.createRef(),n.state={linksPositions:{}},n.getZoom=n.getZoom.bind(n),n.onUpdatePreviewLink=n.onUpdatePreviewLink.bind(n),n.onNodePinPositionsUpdate=n.onNodePinPositionsUpdate.bind(n),n.onSelectItem=n.onSelectItem.bind(n),n.onCreateLink=n.onCreateLink.bind(n),n.onConnectorUpdate=n.onConnectorUpdate.bind(n),n.onNodeMove=n.onNodeMove.bind(n),n.filterRenderedNodes=n.filterRenderedNodes.bind(n),n.filterRenderedLinks=n.filterRenderedLinks.bind(n),n}return ht(e,t),e.prototype.componentDidMount=function(){this.updateLinkPositions()},e.prototype.componentDidUpdate=function(){this.updateLinkPositions()},e.prototype.onSelectItem=function(t,e){var n=this.props,o=n.selectedItems,a=n.onSelectedItems;if(t||e){if(t&&e&&v.a.some(o,t)){var i=ft([],o,!0),r=-1;o.forEach((function(e,n){e.id===t.id&&e.type===t.type&&(r=n)})),-1!==r&&i.splice(r,1),a(i)}else if(t&&!v.a.some(o,t)){i=ft([],o,!0);e||(i=[]),i.push(t),a(i)}}else a([]);!e&&t&&a([t])},e.prototype.onUpdatePreviewLink=function(t){this.setState({draggedLink:t})},e.prototype.onNodePinPositionsUpdate=function(t,e){this.nodesPinPositions[t]=e},e.prototype.onCreateLink=function(t){var e=this.props.onCreateLink;e&&t.inputPinSide!==t.outputPinSide&&t.inputNodeId!==t.outputNodeId&&e(t)},e.prototype.onNodeMove=function(t,e,n,o){var a=this.props.onNodeMove;a&&a(t,e,n,o)},e.prototype.onConnectorUpdate=function(t,e,n){var o=this.props.onConnectorUpdate;o&&o(t,e,n)},e.prototype.getZoom=function(){return this.props.panZoomInfo.zoom},e.prototype.updateLinkPositions=function(){var t=this,e=this.props.links,n=this.state.linksPositions,a=!1,i=Object(d.c)(n,(function(i){Object.keys(e).forEach((function(n){var r=e[n];if(r.inputNodeId in t.nodesPinPositions!==!1&&r.outputNodeId in t.nodesPinPositions!==!1){var c=t.nodesPinPositions[r.inputNodeId][r.inputPinId],u=t.nodesPinPositions[r.outputNodeId][r.outputPinId];if(c&&u){var s=c[r.inputPinSide===o.LEFT?0:1],l=u[r.outputPinSide===o.LEFT?0:1];s&&l&&(n in i&&h(i[n].inputPinPosition,s)&&h(i[n].outputPinPosition,l)||(i[n]={linkId:n,inputPinPosition:s,outputPinPosition:l},a=!0))}}})),Object.keys(n).forEach((function(t){t in e||(delete i[t],a=!0)}))}));a&&this.setState({linksPositions:i})},e.prototype.filterRenderedNodes=function(){var t=this.props,e=t.nodes,n=t.panZoomInfo,o=this.mainDivRef.current;if(!o)return e;var a=-n.topLeftCorner.x/n.zoom-50,i=-n.topLeftCorner.y/n.zoom-50,r=a+o.offsetWidth/n.zoom+100,c=i+o.offsetHeight/n.zoom+100,u={},s=function(t,e,n){return t>=e&&t<=n};return Object.keys(e).forEach((function(t){var n=e[t],o=s(a,n.position.x,n.position.x+n.width)||s(n.position.x,a,r),l=s(i,n.position.y,n.position.y+1e3)||s(n.position.y,i,c);o&&l&&(u[t]=n)})),u},e.prototype.filterRenderedLinks=function(t){var e=this.props.links,n={};return Object.keys(e).forEach((function(o){var a=e[o];(t.includes(a.inputNodeId)||t.includes(a.outputNodeId))&&(n[o]=a)})),n},e.prototype.render=function(){var t=this.props,e=t.selectedItems,n=t.panZoomInfo,o=t.theme,a=this.props,i=a.onPanZoomInfo,c=a.createCustomConnectorComponent,u=this.state,s=u.draggedLink,l=u.linksPositions,d=this.filterRenderedNodes(),p=this.filterRenderedLinks(Object.keys(d));return r.a.createElement(O.Provider,{value:o||g},r.a.createElement("div",{style:{width:"100%",height:"100%"},ref:this.mainDivRef},r.a.createElement(k,{panZoomInfo:n},r.a.createElement(b,{panZoomInfo:n,onPanZoomInfo:i,onSelectItem:this.onSelectItem},r.a.createElement(S,{links:p,linksPositions:l,draggedLink:s,selectedItems:e,onSelectItem:this.onSelectItem}),r.a.createElement(vt,{nodes:d,getZoom:this.getZoom,onNodeMove:this.onNodeMove,onCreateLink:this.onCreateLink,onUpdatePreviewLink:this.onUpdatePreviewLink,onConnectorUpdate:this.onConnectorUpdate,onNodePinPositionsUpdate:this.onNodePinPositionsUpdate,selectedItems:e,onSelectItem:this.onSelectItem,createCustomConnectorComponent:c})))))},e}(i.Component),bt=function(t){var e=t.name,n=t.onClick,o=t.onMouseEnter,a=t.onMouseLeave;return r.a.createElement("div",{onClick:n,onMouseEnter:o,onMouseLeave:a},e)},gt=function(t){var e=t.items;return r.a.createElement(r.a.Fragment,null,Object.keys(e).map((function(t){var n=e[t];return r.a.createElement(bt,{name:n.name,onClick:n.onClick,onMouseEnter:n.onMouseEnter,onMouseLeave:n.onMouseLeave,key:t})})))},Ot=function(t){var e=t.menuTitle,n=t.items,o=r.a.useState(""),a=o[0],i=o[1],c=r.a.useCallback((function(t){i(t.currentTarget.value)}),[a]),u=Object(d.a)(n,(function(t){Object.keys(n).forEach((function(e){var o=n[e].name.toLowerCase(),i=a.toLowerCase();""===a||o.includes(i)||delete t[e]}))}));return r.a.createElement(r.a.Fragment,null,e,r.a.createElement("br",null),r.a.createElement("input",{value:a,onChange:c,placeholder:"Filter options"}),r.a.createElement(gt,{items:u}))},Pt=function(){return Pt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},Pt.apply(this,arguments)},kt=function(t){var e=t.node,n=t.createCustomConnectorComponent,o=r.a.useRef(null),a=null;if(e&&o&&o.current){var i=o.current.getBoundingClientRect(),c=Pt({},e);c.position={x:10,y:10},c.width=i.width-20,a=e?r.a.createElement(dt,{nodeId:"0",getZoom:function(){return 1},isNodeSelected:!0,node:c,onConnectorUpdate:function(){return null},onNodePinPositionsUpdate:function(){return null},createCustomConnectorComponent:n}):null}return r.a.createElement("div",{ref:o,style:{position:"relative",gridArea:"preview",overflow:"hidden",width:"500px",height:"500px"}},a)},jt=function(t){var e=t.nodesSchema,n=t.onNodeSelection,o=t.createCustomConnectorComponent,a=t.onMouseHover,i=r.a.useState(""),c=i[0],u=i[1],s={};Object.keys(e).forEach((function(t){s[t]={name:e[t].name,onMouseEnter:function(){u(t)},onMouseLeave:function(){u("")},onClick:function(){n(t)}}}));var l=r.a.useCallback((function(){a(!0)}),[a]),d=r.a.useCallback((function(){a(!1)}),[a]);return r.a.createElement("div",{style:{display:"flex"},onMouseLeave:d,onMouseEnter:l},r.a.createElement("div",null,r.a.createElement(Ot,{menuTitle:"Add a new node",items:s})),r.a.createElement(kt,{node:c?e[c]:null,createCustomConnectorComponent:o}))},xt=function(t){var e=t.onMouseHover,n=t.onDeleteSelection,o={};o.delete_selection={name:"Delete selection",onClick:function(){n()}};var a=r.a.useCallback((function(){e(!0)}),[e]),i=r.a.useCallback((function(){e(!1)}),[e]);return r.a.createElement("div",{onMouseLeave:i,onMouseEnter:a},r.a.createElement(Ot,{menuTitle:"Selection management",items:o}))},It=n(0),Ct=n(1);function wt(t,e){var n={};return Object.keys(e).forEach((function(o){e[o].outputNodeId===t&&(n[o]=e[o])})),n}function Nt(t,e){var n={};return Object.keys(e).forEach((function(o){e[o].inputNodeId===t&&(n[o]=e[o])})),n}function Et(t){var e=[];return Object.keys(t).forEach((function(n){return e.push([n,t[n]])})),e.sort((function(t,e){return t[1]-e[1]})),e.map((function(t){var e=Object(s.a)(t,2),n=e[0];e[1];return n}))}function _t(t,e,n,o){o[t]=t in o?Math.max(n,o[t]):n;var a=wt(t,e);Object.keys(a).forEach((function(t){_t(e[t].inputNodeId,e,n+1,o)}))}function Tt(t,e,n,o,a){t.forEach((function(t){var i=n[t],r=Nt(t,o),c={};Object.keys(r).forEach((function(t){if(t in e){var n=o[t].inputPinId;i.connectors[n].isMultiInputAllowed?(n in c||(c[n]=[]),c[n].push(e[t])):c[n]=e[t]}}));var u=i.computeSpecific(c,t,a,n,o),s=wt(t,o);Object.keys(s).forEach((function(t){e[t]=u[o[t].outputPinId]}))}))}function Lt(t,e,n,o){var a={};Object.keys(e).forEach((function(t){_t(t,n,0,a)})),Tt(Et(a),t,e,n,o)}function St(t,e,n,o,a){var i={};_t(t,o,0,i);var r=Et(i),c="";if(r.forEach((function(t){n[t].name===mt.FunctionOutputNode&&(c=t)})),""===c)Tt(r,e,n,o,a);else{var u=Nt(c,o),s="";Object.keys(u).forEach((function(t){"0"===o[t].inputPinId&&(s=o[t].outputNodeId)}));var l=n[s];if(l.name===mt.FunctionInputNode){var d=l.connectors[0].data.value,p=[];Object.keys(n).forEach((function(t){n[t].name===mt.FunctionCallNode&&n[t].connectors[0].data.value===d&&p.push(t),n[t].name===mt.Map&&n[t].connectors[2].data.value===d&&p.push(t)})),p.forEach((function(t){return St(t,e,n,o,a)}))}}}function Ft(t,e,n,o,a,i,r){if(!t.includes(e)){var c=o[e],u=Nt(e,a),s=Object.keys(u).map((function(t){return a[t].outputNodeId}));if(c.name===mt.IfElse){var l="";Object.keys(u).forEach((function(e){"1"===a[e].inputPinId&&(l=e,Ft(t,a[e].outputNodeId,n,o,a,i,r))}));var d=n[l];Object.keys(u).forEach((function(e){("2"===a[e].inputPinId&&d||"3"===a[e].inputPinId&&!d)&&Ft(t,a[e].outputNodeId,n,o,a,i,r)}))}else c.name===mt.FunctionOutputNode?(Object.keys(u).forEach((function(e){"0"===a[e].inputPinId&&Ft(t,a[e].outputNodeId,n,o,a,i,r)})),s.forEach((function(e){return Ft(t,e,n,o,a,i,r)}))):s.forEach((function(e){return Ft(t,e,n,o,a,i,r)}));var p=Nt(e,a),v={};Object.keys(p).forEach((function(t){if(t in n){var e=a[t].inputPinId;c.connectors[e].isMultiInputAllowed?(e in v||(v[e]=[]),v[e].push(n[t])):v[e]=n[t]}}));var h=c.computeSpecific(c.name===mt.FunctionInputNode?r:v,e,i,o,a),f=wt(e,a);Object.keys(f).forEach((function(t){n[t]=h[a[t].outputPinId]})),t.push(e)}}function Mt(t,e,n,o,a){var i={},r=Object.keys(n).find((function(e){var o=n[e];return o.outputNodeId===t&&"0"===o.outputPinId}));if(r){var c=n[r].inputNodeId;Ft([],c,i,e,n,o,a);var u=Object.keys(n).find((function(t){var e=n[t];return e.inputNodeId===c&&"1"===e.inputPinId}));return u&&u in i?i[u]:void 0}console.log("no node id")}!function(t){t.Canvas="canvas",t.Color="color",t.Number="number",t.Rectangle="rectangle",t.Rotate="rotate",t.Timer="timer",t.Translate="translate",t.IfElse="if-else",t.String="string",t.Split="split",t.Operation="operation",t.Log="log",t.Arc="arc",t.Check="check",t.Boolean="boolean",t.FunctionInputNode="function-inputs",t.FunctionOutputNode="function-outputs",t.FunctionCallNode="function-call",t.ThreeJS="threejs",t.ThreeJSBox="threejs-box",t.Range="range",t.Map="map"}(mt||(mt={}));var Rt=function(){function t(e,n,o,a){Object(It.a)(this,t),this[l.b]=!0,this.name=void 0,this.position=void 0,this.width=void 0,this.connectors=void 0,this.name=e,this.width=n,this.position=o,this.connectors=a}return Object(Ct.a)(t,null,[{key:"initFromJson",value:function(t,e){e.name=t.name,e.width=t.width,e.position=t.position,e.connectors=t.connectors}}]),t}(),zt=n(2),Jt=n(3),Ut=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Canvas,430,{x:0,y:0},{0:{name:"draw",pinLayout:a.LEFT_PIN,contentType:"canvas",data:{canvas_width:400,canvas_height:400,canvas_color:"white"},isMultiInputAllowed:!0},1:{name:"width",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:400}},2:{name:"height",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:400}},3:{name:"color",pinLayout:a.LEFT_PIN,contentType:"none",data:{value:"white"},leftPinColor:"orange"}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o=Number("1"in t?t[1]:this.connectors[1].data.value),a=Number("2"in t?t[2]:this.connectors[2].data.value),i="3"in t?t[3]:this.connectors[3].data.value,r=function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height),t[0]&&t[0].forEach((function(t){Array.isArray(t)?t.forEach((function(t){return t(e)})):t(e)}))};return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.canvas_width=Number(o),n[e].connectors[0].data.canvas_height=Number(a),n[e].connectors[0].data.canvas_color=i,n[e].connectors[0].data.canvas_draw=r,n[e].connectors[1].data.disabled="1"in t,n[e].connectors[1].data.value=o,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=a}))})),{}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Ht=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Rectangle,200,{x:0,y:0},{0:{name:"draw",pinLayout:a.RIGHT_PIN,contentType:"none",data:{}},1:{name:"x",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},2:{name:"y",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},3:{name:"width",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:100,disabled:!1}},4:{name:"height",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:100,disabled:!1}},5:{name:"color",pinLayout:a.LEFT_PIN,contentType:"none",data:{value:"black"},leftPinColor:"orange"},6:{name:"type",pinLayout:a.NO_PINS,contentType:"select",data:{values:["fill","stroke","clear"],selected_index:0}},7:{name:"line width",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:1,disabled:!1}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o="1"in t?t[1]:this.connectors[1].data.value,a="2"in t?t[2]:this.connectors[2].data.value,i="3"in t?t[3]:this.connectors[3].data.value,r="4"in t?t[4]:this.connectors[4].data.value,c="5"in t?t[5]:this.connectors[5].data.value,u="7"in t?t[7]:this.connectors[7].data.value;n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[1].data.disabled="1"in t,n[e].connectors[1].data.value=o,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=a,n[e].connectors[3].data.disabled="3"in t,n[e].connectors[3].data.value=i,n[e].connectors[4].data.disabled="4"in t,n[e].connectors[4].data.value=r,n[e].connectors[7].data.disabled="7"in t,n[e].connectors[7].data.value=u}))}));var s=this.connectors[6].data.selected_index;return{0:function(t){if(0===s)t.fillStyle=c,t.fillRect(o,a,i,r),t.fillStyle="black";else if(1===s){t.strokeStyle=c;var e=t.lineWidth;t.lineWidth=u,t.strokeRect(o,a,i,r),t.lineWidth=e,t.strokeStyle="black"}else 2===s&&t.clearRect(o,a,i,r)}}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Dt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Rotate,150,{x:0,y:0},{0:{name:"draw",pinLayout:a.BOTH_PINS,contentType:"none",data:{}},1:{name:"angle",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o="1"in t?t[1]:this.connectors[1].data.value;o=o*Math.PI/180,n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[1].data.disabled="1"in t,n[e].connectors[1].data.value=o}))}));return{0:function(e){e.rotate(o),t[0]&&t[0].forEach((function(t){t(e)})),e.rotate(-o)}}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),At=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Number,170,{x:0,y:0},{0:{name:"number",pinLayout:a.RIGHT_PIN,contentType:"number",data:{value:0}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(){return{0:Number(this.connectors[0].data.value)}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Zt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Color,150,{x:0,y:0},{0:{name:"color",pinLayout:a.RIGHT_PIN,contentType:"canvas",data:{canvas_width:120,canvas_height:40,canvas_color:"black"},rightPinColor:"orange"},1:{name:"red",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0}},2:{name:"green",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0}},3:{name:"blue",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0}},4:{name:"alpha",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:1}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o=this,a="1"in t?t[1]:this.connectors[1].data.value,i="2"in t?t[2]:this.connectors[2].data.value,r="3"in t?t[3]:this.connectors[3].data.value,c="4"in t?t[4]:this.connectors[4].data.value;i=i>255?255:i<0?0:i,r=r>255?255:r<0?0:r,c=c>1?1:c<0?0:c;var u="rgba(".concat(a=a>255?255:a<0?0:a,", ").concat(i,", ").concat(r,", ").concat(c,")");return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.canvas_width=o.width-30,n[e].connectors[0].data.canvas_color=u,n[e].connectors[1].data.disabled="1"in t,n[e].connectors[1].data.value=a,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=i,n[e].connectors[3].data.disabled="3"in t,n[e].connectors[3].data.value=r,n[e].connectors[4].data.disabled="4"in t,n[e].connectors[4].data.value=c}))})),{0:u}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Gt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Timer,150,{x:0,y:0},{0:{name:"count",pinLayout:a.RIGHT_PIN,contentType:"number",data:{value:"0"}},1:{name:"is_running",pinLayout:a.NO_PINS,contentType:"check_box",data:{value:!1}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Bt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Translate,100,{x:0,y:0},{0:{name:"draw",pinLayout:a.BOTH_PINS,contentType:"none",data:{}},1:{name:"x",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0}},2:{name:"y",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o="1"in t?t[1]:this.connectors[1].data.value,a="2"in t?t[2]:this.connectors[2].data.value;n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[1].data.disabled="1"in t,n[e].connectors[1].data.value=o,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=a}))}));return{0:function(e){e.translate(o,a),t[0]&&t[0].forEach((function(t){t(e)})),e.translate(-o,-a)}}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Wt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.IfElse,100,{x:0,y:0},{0:{name:"out_value",pinLayout:a.RIGHT_PIN,contentType:"none",data:{}},1:{name:"test",pinLayout:a.LEFT_PIN,contentType:"check_box",data:{value:!1}},2:{name:"if_value",pinLayout:a.LEFT_PIN,contentType:"none",data:{}},3:{name:"else_value",pinLayout:a.LEFT_PIN,contentType:"none",data:{}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o="1"in t?t[1]:this.connectors[1].data.value,a="2"in t?t[2]:null,i={0:"3"in t?t[3]:null};return o&&(i={0:a}),n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[1].data.disabled="1"in t,n[e].connectors[1].data.value=o}))})),i}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Vt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.String,100,{x:0,y:0},{0:{name:"string",pinLayout:a.RIGHT_PIN,contentType:"string",data:{value:""}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),qt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Split,100,{x:0,y:0},{0:{name:"out",pinLayout:a.RIGHT_PIN,contentType:"none",data:{}},1:{name:"input",pinLayout:a.LEFT_PIN,contentType:"text_area",data:{value:""}},2:{name:"separator",pinLayout:a.LEFT_PIN,contentType:"string",data:{value:"",height:"20px"}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t){var e="1"in t?t[1]:this.connectors[1].data.value,n="2"in t?t[2]:this.connectors[2].data.value;return{0:n[0]?e.split(n[0]):e}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Xt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Operation,160,{x:0,y:0},{0:{name:"output",pinLayout:a.RIGHT_PIN,contentType:"number",data:{value:0,disabled:!0}},1:{name:"type",pinLayout:a.NO_PINS,contentType:"select",data:{values:["add","substract","multiply","divide","modulo","minimum","maximum","exp","log","log10","negate","sin","cos","tan"],selected_index:0}},2:{name:"x",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},3:{name:"y",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o=Number("2"in t?t[2]:this.connectors[2].data.value),a=Number("3"in t?t[3]:this.connectors[3].data.value),i=0;switch(this.connectors[1].data.selected_index){case 0:i=o+a;break;case 1:i=o-a;break;case 2:i=o*a;break;case 3:i=isNaN(o/a)?0:o/a;break;case 4:i=isNaN(o%a)?0:o%a;break;case 5:i=o>a?a:o;break;case 6:i=o>a?o:a;break;case 7:i=Math.pow(o,a);break;case 8:i=Math.log(o);break;case 9:i=Math.log10(o);break;case 10:i=-o;break;case 11:i=Math.sin(o);break;case 12:i=Math.cos(o);break;case 13:i=Math.tan(o)}return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.value=i,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=o,n[e].connectors[3].data.disabled="3"in t,n[e].connectors[3].data.value=a}))})),{0:i}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Yt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){var t;return Object(It.a)(this,n),(t=e.call(this,mt.Log,100,{x:0,y:0},{0:{name:"log",pinLayout:a.LEFT_PIN,contentType:"text_area",data:{value:"",disabled:!0},leftPinColor:"red"}})).inputs=void 0,t}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.value="0"in t?JSON.stringify(t[0]):""}))})),{}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Kt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Arc,200,{x:0,y:0},{0:{name:"draw",pinLayout:a.RIGHT_PIN,contentType:"none",data:{}},1:{name:"x",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},2:{name:"y",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},3:{name:"radius",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:100,disabled:!1}},4:{name:"start angle",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},5:{name:"end angle",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:2*Math.PI,disabled:!1}},6:{name:"color",pinLayout:a.LEFT_PIN,contentType:"none",data:{value:"black"},leftPinColor:"orange"},7:{name:"type",pinLayout:a.NO_PINS,contentType:"select",data:{values:["fill","stroke"],selected_index:0}},8:{name:"line width",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:1,disabled:!1}},9:{name:"counterclockwise",pinLayout:a.LEFT_PIN,contentType:"check_box",data:{value:!1}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o="1"in t?t[1]:this.connectors[1].data.value,a="2"in t?t[2]:this.connectors[2].data.value,i="3"in t?t[3]:this.connectors[3].data.value,r="4"in t?t[4]:this.connectors[4].data.value,c="5"in t?t[5]:this.connectors[5].data.value,u="6"in t?t[6]:this.connectors[6].data.value,s="8"in t?t[8]:this.connectors[8].data.value,d="9"in t?t[9]:this.connectors[9].data.value;n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[1].data.disabled="1"in t,n[e].connectors[1].data.value=o,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=a,n[e].connectors[3].data.disabled="3"in t,n[e].connectors[3].data.value=i,n[e].connectors[4].data.disabled="4"in t,n[e].connectors[4].data.value=r,n[e].connectors[5].data.disabled="5"in t,n[e].connectors[5].data.value=c,n[e].connectors[8].data.disabled="8"in t,n[e].connectors[8].data.value=s}))}));var p=this.connectors[7].data.selected_index;return{0:function(t){if(0===p)t.fillStyle=u,t.beginPath(),t.arc(o,a,i,r,c,d),t.closePath(),t.fill(),t.fillStyle="black";else if(1===p){t.strokeStyle=u;var e=t.lineWidth;t.lineWidth=s,t.beginPath(),t.arc(o,a,i,r,c,d),t.closePath(),t.stroke(),t.lineWidth=e,t.strokeStyle="black"}}}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),Qt=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Check,160,{x:0,y:0},{0:{name:"output",pinLayout:a.RIGHT_PIN,contentType:"none",data:{value:!1,disabled:!0}},1:{name:"type",pinLayout:a.NO_PINS,contentType:"select",data:{values:["===","!==","<","<=",">",">="],selected_index:0}},2:{name:"x",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},3:{name:"y",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o=Number("2"in t?t[2]:this.connectors[2].data.value),a=Number("3"in t?t[3]:this.connectors[3].data.value),i=!1;switch(this.connectors[1].data.selected_index){case 0:i=o===a;break;case 1:i=o!==a;break;case 2:i=o<a;break;case 3:i=o<=a;break;case 4:i=o>a;break;case 5:i=o>=a}return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.value=i,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=o,n[e].connectors[3].data.disabled="3"in t,n[e].connectors[3].data.value=a}))})),{0:i}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),$t=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Boolean,160,{x:0,y:0},{0:{name:"output",pinLayout:a.RIGHT_PIN,contentType:"none",data:{value:!1,disabled:!0}},1:{name:"type",pinLayout:a.NO_PINS,contentType:"select",data:{values:["===","!==","&&","||","!"],selected_index:0}},2:{name:"x",pinLayout:a.LEFT_PIN,contentType:"check_box",data:{value:!1}},3:{name:"y",pinLayout:a.LEFT_PIN,contentType:"check_box",data:{value:!1}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){var o="2"in t?t[2]:this.connectors[2].data.value,a="3"in t?t[3]:this.connectors[3].data.value,i=!1;switch(this.connectors[1].data.selected_index){case 0:i=o===a;break;case 1:i=o!==a;break;case 2:i=o&&a;break;case 3:i=o||a;break;case 4:i=!o}return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.value=i,n[e].connectors[2].data.disabled="2"in t,n[e].connectors[2].data.value=o,n[e].connectors[3].data.disabled="3"in t,n[e].connectors[3].data.value=a}))})),{0:i}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),te=n(11),ee=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.FunctionCallNode,150,{x:0,y:0},{0:{name:"function_name",pinLayout:a.NO_PINS,contentType:"string",data:{value:""}},1:{name:"output",pinLayout:a.RIGHT_PIN,contentType:"none",data:{}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n,o,i){var r=this.connectors[0].data.value,c=[],u="";Object.keys(o).forEach((function(t){var e=o[t];e.name===mt.FunctionInputNode&&e.connectors[0].data.value===r&&(u=t,Object.keys(e.connectors).forEach((function(t){Number(t)>2&&e&&c.push(e.connectors[t].name)})))})),n((function(t){return Object(l.a)(t,(function(t){e&&(Object.keys(t[e].connectors).forEach((function(n){Number(n)>1&&delete t[e].connectors[n]})),c.forEach((function(n,o){t[e].connectors[o+2]={name:n,pinLayout:a.LEFT_PIN,contentType:"none",data:{}}})))}))}));var s={};return c.forEach((function(e,n){n+2 in t&&(s["".concat(n+3)]=t["".concat(n+2)])})),u.length>0?{1:Mt(u,o,i,n,s)}:{}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),ne=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){var t;return Object(It.a)(this,n),(t=e.call(this,mt.FunctionInputNode,150,{x:0,y:0},{0:{name:"name",pinLayout:a.RIGHT_PIN,contentType:"string",data:{value:""}},1:{name:"add",pinLayout:a.NO_PINS,contentType:"button",data:{label:"add input"}},2:{name:"remove",pinLayout:a.NO_PINS,contentType:"button",data:{label:"remove input"}}})).nodeId=void 0,t.setNodes=void 0,t.add=t.add.bind(Object(te.a)(t)),t.remove=t.remove.bind(Object(te.a)(t)),t.connectors[1].data.onClick=t.add,t.connectors[2].data.onClick=t.remove,t}return Object(Ct.a)(n,[{key:"add",value:function(t){var e=this;this.nodeId&&this.setNodes&&this.setNodes((function(n){return Object(l.a)(n,(function(n){e.nodeId&&(n[e.nodeId].connectors[Object.keys(t.connectors).length]={name:"param-".concat(Object.keys(t.connectors).length-2),pinLayout:a.RIGHT_PIN,contentType:"string",data:{value:"param-".concat(Object.keys(t.connectors).length-2)}})}))}))}},{key:"remove",value:function(t){Object.keys(t.connectors).length}},{key:"computeSpecific",value:function(t,e,n){return t}}],[{key:"createFromJson",value:function(t,e,o){var a=new n;return Rt.initFromJson(t,a),a.nodeId=e,a.setNodes=o,a.connectors[1].data.onClick=a.add.bind(a),a.connectors[2].data.onClick=a.remove.bind(a),a}}]),n}(Rt),oe=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.FunctionOutputNode,150,{x:0,y:0},{0:{name:"function",pinLayout:a.LEFT_PIN,contentType:"none",data:{},rightPinColor:"orange"},1:{name:"return",pinLayout:a.LEFT_PIN,contentType:"none",data:{},rightPinColor:"orange"}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){return{}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),ae=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.ThreeJS,170,{x:0,y:0},{0:{name:"threejs",pinLayout:a.LEFT_PIN,contentType:"threejs",data:{}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.obj=t[0]?t[0][0]:void 0}))})),{}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e.connectors[0].data={},e}}]),n}(Rt),ie=n(14),re=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){var t;Object(It.a)(this,n),(t=e.call(this,mt.ThreeJSBox,170,{x:0,y:0},{0:{name:"output",pinLayout:a.RIGHT_PIN,contentType:"node",data:{}},1:{name:"rotation_x",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},2:{name:"rotation_y",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},3:{name:"rotation_z",pinLayout:a.LEFT_PIN,contentType:"number",data:{value:0,disabled:!1}},4:{name:"color",pinLayout:a.LEFT_PIN,contentType:"none",data:{value:"rgba(255,255,255,1)"},leftPinColor:"orange"}})).cube=void 0;var o=new ie.a(1,1,1),i=new ie.c({color:16777215});return t.cube=new ie.b(o,i),t}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t){var e="1"in t?t[1]:this.connectors[1].data.value,n="2"in t?t[2]:this.connectors[2].data.value,o="3"in t?t[3]:this.connectors[3].data.value,a="4"in t?t[4]:this.connectors[4].data.value;return this.cube.material.color.setStyle(a),this.cube.rotation.set(e,n,o),{0:this.cube}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),ce=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Range,170,{x:0,y:0},{0:{name:"count",pinLayout:a.BOTH_PINS,contentType:"number",data:{value:0}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n){for(var o=(Number("0"in t?t[0]:this.connectors[0].data.value)),a=[],i=0;i<o;)a.push(i),i++;return n((function(n){return Object(l.a)(n,(function(n){n[e].connectors[0].data.disabled="0"in t}))})),{0:a}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt),ue=function(t){Object(zt.a)(n,t);var e=Object(Jt.a)(n);function n(){return Object(It.a)(this,n),e.call(this,mt.Map,150,{x:0,y:0},{0:{name:"output",pinLayout:a.RIGHT_PIN,contentType:"none",data:{}},1:{name:"input",pinLayout:a.LEFT_PIN,contentType:"none",data:{}},2:{name:"f",pinLayout:a.NO_PINS,contentType:"string",data:{value:""}}})}return Object(Ct.a)(n,[{key:"computeSpecific",value:function(t,e,n,o,a){var i=this.connectors[2].data.value,r="";if(Object.keys(o).forEach((function(t){var e=o[t];e.name===mt.FunctionInputNode&&e.connectors[0].data.value===i&&(r=t)})),!("1"in t)||""===r)return{0:[]};var c=[];return t[1].forEach((function(t){var e={};e[3]=t,c.push(Mt(r,o,a,n,e))})),{0:c}}}],[{key:"createFromJson",value:function(t){var e=new n;return Rt.initFromJson(t,e),e}}]),n}(Rt);function se(t,e,n){var o=void 0;switch(t.name){case mt.Canvas:o=Ut.createFromJson(t);break;case mt.Color:o=Zt.createFromJson(t);break;case mt.Number:o=At.createFromJson(t);break;case mt.Rectangle:o=Ht.createFromJson(t);break;case mt.Rotate:o=Dt.createFromJson(t);break;case mt.Timer:o=Gt.createFromJson(t);break;case mt.Translate:o=Bt.createFromJson(t);break;case mt.IfElse:o=Wt.createFromJson(t);break;case mt.String:o=Vt.createFromJson(t);break;case mt.Split:o=qt.createFromJson(t);break;case mt.Operation:o=Xt.createFromJson(t);break;case mt.Log:o=Yt.createFromJson(t);break;case mt.Arc:o=Kt.createFromJson(t);break;case mt.Check:o=Qt.createFromJson(t);break;case mt.Boolean:o=$t.createFromJson(t);break;case mt.FunctionInputNode:o=ne.createFromJson(t,e,n);break;case mt.FunctionOutputNode:o=oe.createFromJson(t);break;case mt.FunctionCallNode:o=ee.createFromJson(t);break;case mt.ThreeJS:o=ae.createFromJson(t);break;case mt.ThreeJSBox:o=re.createFromJson(t);break;case mt.Range:o=ce.createFromJson(t);break;case mt.Map:o=ue.createFromJson(t)}if(!o)throw new Error("Error while reading node from json");return o}var le=n(7),de=function(t){var e=Object(i.useRef)(null);return Object(i.useEffect)((function(){if(e.current){var n=e.current.getContext("2d");n&&t.connector.data.canvas_draw&&t.connector.data.canvas_draw(n)}}),[e,t.connector.data]),Object(le.jsxs)(le.Fragment,{children:[Object(le.jsx)("div",{style:{position:"absolute",zIndex:.1,backgroundColor:t.connector.data.canvas_color,width:t.connector.data.canvas_width,height:t.connector.data.canvas_height}}),Object(le.jsx)("canvas",{style:{position:"relative",imageRendering:"auto"},width:t.connector.data.canvas_width,height:t.connector.data.canvas_height,ref:e})]})},pe=function(t){var e=Object(i.useRef)(null);return Object(i.useEffect)((function(){if(e.current){var n=e.current,o=new ie.f,a=new ie.d(75,window.innerWidth/window.innerHeight,.1,1e3),i=new ie.g,r=new ie.e(16711680,1,100);r.position.set(1,1,1),o.add(r),i.setSize(500,500),n.appendChild(i.domElement),a.position.z=5,t.connector.data.obj&&o.add(t.connector.data.obj);var c=0;return function t(){c=requestAnimationFrame(t),i.render(o,a)}(),function(){cancelAnimationFrame(c),n.removeChild(i.domElement),i.dispose()}}}),[e,t.connector.data]),Object(le.jsx)("div",{style:{width:500,height:500},ref:e})};function ve(t){var e=t.connector;return"canvas"===e.contentType?Object(le.jsx)(de,Object(u.a)({},t)):"threejs"===e.contentType?Object(le.jsx)(pe,Object(u.a)({},t)):null}var he={},fe=function(){var t=r.a.useState(null),e=Object(s.a)(t,2),n=e[0],o=e[1],a=r.a.useState(!1),c=Object(s.a)(a,2),d=c[0],p=c[1],v=r.a.useState({zoom:1,topLeftCorner:{x:0,y:0}}),h=Object(s.a)(v,2),m=h[0],y=h[1],b=r.a.useState([]),g=Object(s.a)(b,2),O=g[0],P=g[1],k=r.a.useState({}),j=Object(s.a)(k,2),x=j[0],I=j[1],C=r.a.useState({}),w=Object(s.a)(C,2),N=w[0],E=w[1],_=r.a.useState(!1),T=Object(s.a)(_,2),L=T[0],S=T[1];Object(i.useEffect)((function(){var t=localStorage.getItem("nodes"),e=localStorage.getItem("links"),n=t?JSON.parse(t):{},o=e?JSON.parse(e):{};t&&Object.keys(n).forEach((function(t){n[t]=se(n[t],t,I)})),E(o),I(n),S(!0)}),[]),r.a.useEffect((function(){L&&(S(!1),Lt(he,x,N,I))}),[L,N,x]),Object(i.useEffect)((function(){Object.keys(x).length>0&&localStorage.setItem("nodes",JSON.stringify(x))}),[x]),Object(i.useEffect)((function(){Object.keys(N).length>0&&localStorage.setItem("links",JSON.stringify(N))}),[N]);var F={0:new Ut,1:new Ht,2:new Dt,3:new At,4:new Gt,5:new Zt,6:new Bt,7:new Wt,8:new Vt,9:new qt,10:new Xt,11:new Yt,12:new Kt,13:new Qt,14:new $t,15:new ne,16:new oe,17:new ee,18:new ae,19:new re,20:new ce,21:new ue},M=Object(i.useCallback)((function(t){1===t.length&&"node"===t[0].type&&I((function(e){var n=t[0].id,o={};return Object.keys(e).forEach((function(t){t!==n&&(o[t]=e[t])})),o[n]=e[n],o})),P(t)}),[]);r.a.useEffect((function(){var t=setInterval((function(){var t=!1,e=Object(l.c)(x,(function(e){for(var n=0,o=Object.keys(x);n<o.length;n++){var a=o[n];"timer"===e[a].name&&e[a].connectors[1].data.value&&(e[a].connectors[0].data.value=(Number(e[a].connectors[0].data.value)+1).toString(),t=!0)}}));t&&(I(e),Lt(he,x,N,I))}),1e3/60);return function(){return clearInterval(t)}}),[x,N]);var R=r.a.useCallback((function(t,e,n,o){I((function(a){return Object(l.c)(a,(function(a){a[t].position={x:e,y:n},a[t].width=o}))}))}),[]),z=r.a.useCallback((function(t){E((function(e){return Object(l.c)(e,(function(e){e[f()]=t}))}));var e=Object(l.c)(N,(function(e){e[f()]=t}));St(t.outputNodeId,he,x,e,I)}),[N,x]),J=r.a.useCallback((function(){var t=O.filter((function(t){return"node"===t.type})).map((function(t){return t.id})),e=O.filter((function(t){return"link"===t.type})).map((function(t){return t.id}));I((function(e){return Object(l.c)(e,(function(e){t.forEach((function(t){delete e[t]}))}))})),E((function(n){return Object(l.c)(n,(function(o){Object.keys(n).forEach((function(e){var a=n[e];(t.includes(a.inputNodeId)||t.includes(a.outputNodeId))&&delete o[e]})),e.forEach((function(t){delete o[t]}))}))}));var n=Object(l.c)(x,(function(e){t.forEach((function(t){delete e[t]}))})),o=[],a=Object(l.c)(N,(function(n){Object.keys(N).forEach((function(e){var a=N[e];(t.includes(a.inputNodeId)||t.includes(a.outputNodeId))&&(t.includes(a.outputNodeId)&&!t.includes(a.inputNodeId)&&o.push(a.inputNodeId),delete n[e])})),e.forEach((function(t){delete n[t]}))}));Object.keys(he).forEach((function(t){t in a||delete he[t]})),o.forEach((function(t){return St(t,he,n,a,I)}))}),[O,x,N]),U=Object(i.useState)(void 0),H=Object(s.a)(U,2),D=H[0],A=H[1];Object(i.useEffect)((function(){D&&(St(D,he,x,N,I),A(void 0))}),[D,x,N]);var Z=r.a.useCallback((function(t){if(n){var e=f();I((function(o){return Object(l.c)(o,(function(o){var a=se(JSON.parse(JSON.stringify(F[t])),e,I),i=-m.topLeftCorner.x/m.zoom+n.x/m.zoom,r=-m.topLeftCorner.y/m.zoom+n.y/m.zoom;a.position={x:i,y:r},o[e]=a}))})),A(e),p(!1),o(null)}}),[m,n,F]),G=r.a.useCallback((function(t,e,n){I((function(o){return Object(l.c)(o,(function(o){o[t].connectors[e]=n}))}));var o=Object(l.c)(x,(function(o){o[t].connectors[e]=n}));St(t,he,o,N,I)}),[x,N]),B=r.a.useCallback((function(t){t.preventDefault(),n?(p(!1),o(null)):o({x:t.pageX,y:t.pageY})}),[n]),W=r.a.useCallback((function(){n&&!d&&(p(!1),o(null))}),[d,n,o]),V=Object(i.useCallback)((function(){var t={nodes:x,links:N},e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(t))),e.setAttribute("download","oura-node-editor.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}),[x,N]),q=Object(i.useCallback)((function(t){if(he={},!(t.target.files.size<1)){var e=new FileReader;e.onload=function(t){if(t.target&&t.target.result&&t.target.result){var e=JSON.parse(atob(t.target.result.substring(29)));Object.keys(e.nodes).forEach((function(t){e.nodes[t]=se(e.nodes[t],t,I)})),I(e.nodes),E(e.links),S(!0)}},e.readAsDataURL(t.target.files[0])}}),[]),X=Object(i.useCallback)((function(){he={},I({}),E({})}),[]),Y=null;n&&0===O.length?Y=Object(le.jsx)("div",{style:{width:640,height:500,position:"absolute",top:n.y,left:n.x,backgroundColor:"white"},children:Object(le.jsx)(jt,{nodesSchema:F,onNodeSelection:Z,onMouseHover:p,createCustomConnectorComponent:ve})}):n&&(Y=Object(le.jsx)("div",{style:{width:640,height:480,position:"absolute",top:n.y,left:n.x,backgroundColor:"white"},children:Object(le.jsx)(xt,{onMouseHover:p,onDeleteSelection:J})}));var K={font:"bold 11px Arial",textDecoration:"none",backgroundColor:"#EEEEEE",color:"#333333",padding:"2px 6px 2px 6px",borderTop:"1px solid #CCCCCC",borderRight:"1px solid #333333",borderBottom:"1px solid #333333",borderLeft:"1px solid #CCCCCC"};return Object(le.jsxs)(le.Fragment,{children:[Object(le.jsxs)("div",{style:{width:"100%",height:"100%"},onContextMenu:B,onMouseDown:W,tabIndex:0,children:[Object(le.jsx)(yt,{panZoomInfo:m,nodes:x,links:N,selectedItems:O,onPanZoomInfo:y,onSelectedItems:M,onNodeMove:R,onCreateLink:z,onConnectorUpdate:G,createCustomConnectorComponent:ve}),Y]}),Object(le.jsx)("button",{onClick:V,style:Object(u.a)({position:"absolute",left:5,bottom:5},K),children:"save"}),Object(le.jsx)("label",{htmlFor:"files",className:"btn",style:Object(u.a)({position:"absolute",left:55,bottom:5},K),children:"load"}),Object(le.jsx)("input",{onChange:q,id:"files",style:{visibility:"hidden"},type:"file"}),Object(le.jsx)("button",{onClick:X,style:Object(u.a)({position:"absolute",right:5,bottom:5},K),children:"reset"})]})},me=function(){return Object(le.jsx)("div",{style:{width:"100%",height:"100vh"},className:"App",children:Object(le.jsx)(fe,{})})},ye=document.getElementById("root");Object(c.createRoot)(ye).render(Object(le.jsx)(r.a.StrictMode,{children:Object(le.jsx)(me,{})}))}},[[37,1,2]]]);
//# sourceMappingURL=main.3e9e6f05.chunk.js.map
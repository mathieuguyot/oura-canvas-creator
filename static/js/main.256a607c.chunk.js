(this["webpackJsonpoura-canvas-creator"]=this["webpackJsonpoura-canvas-creator"]||[]).push([[0],{101:function(t,n,e){},214:function(t,n,e){"use strict";e.r(n);var a,o=e(0),c=e.n(o),r=e(17),i=e.n(r),u=(e(101),e(10)),s=e(15),l=e(12),d=e.n(l),f=e(4),v=e(6),p=e(7),b=function(){function t(n,e,a,o){Object(v.a)(this,t),this[s.b]=!0,this.name=void 0,this.position=void 0,this.width=void 0,this.connectors=void 0,this.name=n,this.width=e,this.position=a,this.connectors=o}return Object(p.a)(t,[{key:"compute",value:function(t,n,e){var a=this,o=Object.keys(t).find((function(n){return t[n]===a}));if(o){var c={};return Object.keys(this.connectors).forEach((function(r){var i=a.connectors[r];if(i.pinLayout===f.d.LEFT_PIN||i.pinLayout===f.d.BOTH_PINS){var u=function(t,n,e){var a=[];return Object.keys(t).forEach((function(o){var c=t[o];(c.inputNodeId===n&&c.inputPinId===e||c.outputNodeId===n&&c.outputPinId===e)&&a.push(c)})),a}(n,o,r);u.forEach((function(a){var u=a.inputNodeId!==o?a.inputNodeId:a.outputNodeId,s=a.inputNodeId===u?a.inputPinId:a.outputPinId;if((a.inputNodeId===u?a.inputPinSide:a.outputPinSide)!==f.e.LEFT||i.pinLayout!==f.d.BOTH_PINS){var l=t[u].compute(t,n,e);r in c||(c[r]=[]),c[r].push(l[s])}}))}})),this.computeSpecific(c,o,e)}return{}}}],[{key:"initFromJson",value:function(t,n){n.name=t.name,n.width=t.width,n.position=t.position,n.connectors=t.connectors}}]),t}(),h=e(9),m=e(8);!function(t){t.Canvas="canvas",t.Color="color",t.Number="number",t.Rectangle="rectangle",t.Rotate="rotate",t.Timer="timer",t.Translate="translate",t.IfElse="if-else",t.String="string",t.Split="split",t.Operation="operation",t.Log="log"}(a||(a={}));var y=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Canvas,430,{x:0,y:0},{0:{name:"draw",pinLayout:f.d.LEFT_PIN,contentType:"canvas",data:{canvas_width:400,canvas_height:400}},1:{name:"width",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:400}},2:{name:"height",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:400}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t,n,e){var a="1"in t?t[1][0]:this.connectors[1].data.value,o="2"in t?t[2][0]:this.connectors[2].data.value;if("canvas_ctx"in this.connectors[0].data){var c=this.connectors[0].data.canvas_ctx;if("clearRect"in c){var r=this.connectors[0].data.canvas_width,i=this.connectors[0].data.canvas_height;r===a&&i===o||(e((function(t){return Object(s.a)(t,(function(t){t[n].connectors[0].data.canvas_width=a,t[n].connectors[0].data.canvas_height=o}))})),c.canvas.width=a,c.canvas.height=o),c.fillStyle="white",c.fillRect(0,0,a,o),c.fillStyle="black",t[0]&&t[0].forEach((function(t){t(c)}))}}return{}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),j=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Rectangle,100,{x:0,y:0},{0:{name:"draw",pinLayout:f.d.RIGHT_PIN,contentType:"none",data:{}},1:{name:"y",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:0}},2:{name:"z",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:0}},3:{name:"width",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:100}},4:{name:"height",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:100}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value,e="2"in t?t[2][0]:this.connectors[2].data.value,a="3"in t?t[3][0]:this.connectors[3].data.value,o="4"in t?t[4][0]:this.connectors[4].data.value;return{0:function(t){t.fillRect(e,n,a,o)}}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),O=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Rotate,100,{x:0,y:0},{0:{name:"draw",pinLayout:f.d.BOTH_PINS,contentType:"none",data:{}},1:{name:"angle",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value;n=n*Math.PI/180;return{0:function(e){e.rotate(n),t[0]&&t[0].forEach((function(t){t(e)})),e.rotate(-n)}}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),I=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Number,100,{x:0,y:0},{0:{name:"number",pinLayout:f.d.RIGHT_PIN,contentType:"number",data:{value:0}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),g=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Color,250,{x:0,y:0},{0:{name:"color",pinLayout:f.d.RIGHT_PIN,contentType:"color",data:{color:"#fff"}},1:{name:"slider",pinLayout:f.d.RIGHT_PIN,contentType:"slider",data:{}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(){return{}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),T=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Timer,125,{x:0,y:0},{0:{name:"count",pinLayout:f.d.RIGHT_PIN,contentType:"number",data:{value:"0"}},1:{name:"is_running",pinLayout:f.d.LEFT_PIN,contentType:"check_box",data:{value:!1}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),k=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Translate,100,{x:0,y:0},{0:{name:"draw",pinLayout:f.d.BOTH_PINS,contentType:"none",data:{}},1:{name:"x",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:0}},2:{name:"y",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value,e="2"in t?t[2][0]:this.connectors[2].data.value;return{0:function(a){a.translate(n,e),t[0]&&t[0].forEach((function(t){t(a)})),a.translate(-n,-e)}}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),L=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.IfElse,100,{x:0,y:0},{0:{name:"out_value",pinLayout:f.d.RIGHT_PIN,contentType:"none",data:{}},1:{name:"test",pinLayout:f.d.LEFT_PIN,contentType:"check_box",data:{value:!1}},2:{name:"if_value",pinLayout:f.d.LEFT_PIN,contentType:"none",data:{}},3:{name:"else_value",pinLayout:f.d.LEFT_PIN,contentType:"none",data:{}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value,e="2"in t?t[2][0]:null,a="3"in t?t[3][0]:null,o={};return n&&e?o={0:e}:!n&&e&&(o={0:a}),o}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),N=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.String,100,{x:0,y:0},{0:{name:"string",pinLayout:f.d.RIGHT_PIN,contentType:"string",data:{value:""}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(){return{0:this.connectors[0].data.value}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),F=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Split,100,{x:0,y:0},{0:{name:"out",pinLayout:f.d.RIGHT_PIN,contentType:"none",data:{}},1:{name:"input",pinLayout:f.d.LEFT_PIN,contentType:"string",data:{value:""}},2:{name:"separator",pinLayout:f.d.LEFT_PIN,contentType:"string",data:{value:"",height:"20px"}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t){var n="1"in t?t[1][0]:this.connectors[1].data.value,e="2"in t?t[2][0]:this.connectors[2].data.value;return{0:e[0]?n.split(e[0]):n}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),w=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.call(this,a.Operation,100,{x:0,y:0},{0:{name:"output",pinLayout:f.d.RIGHT_PIN,contentType:"none",data:{value:0}},1:{name:"type",pinLayout:f.d.NO_PINS,contentType:"select",data:{values:["add","substract","multiply","divide","modulo"],selected_index:0}},2:{name:"x",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:0}},3:{name:"y",pinLayout:f.d.LEFT_PIN,contentType:"number",data:{value:0}}})}return Object(p.a)(e,[{key:"computeSpecific",value:function(t){var n=Number("2"in t?t[2][0]:this.connectors[2].data.value),e=Number("3"in t?t[3][0]:this.connectors[3].data.value),a=0;switch(this.connectors[1].data.selected_index){case 0:a=n+e;break;case 1:a=n-e;break;case 2:a=n*e;break;case 3:a=isNaN(n/e)?0:n/e;break;case 4:a=isNaN(n%e)?0:n%e}return{0:a}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n}}]),e}(b),_=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){var t;return Object(v.a)(this,e),(t=n.call(this,a.Log,100,{x:0,y:0},{0:{name:"log",pinLayout:f.d.LEFT_PIN,contentType:"none",data:{}},1:{name:"log",pinLayout:f.d.NO_PINS,contentType:"button",data:{label:"log"}}})).inputs=void 0,t.inputs=[],t.connectors[1].data.onClick=t.log,t}return Object(p.a)(e,[{key:"log",value:function(t){t.inputs.forEach((function(t){console.log(t)}))}},{key:"computeSpecific",value:function(t,n,e){return t[0]&&!d.a.isEqual(t[0],this.inputs)&&e((function(e){return Object(s.a)(e,(function(e){e[n].inputs=t[0]}))})),{}}}],[{key:"createFromJson",value:function(t){var n=new e;return b.initFromJson(t,n),n.connectors[1].data.onClick=n.log,n}}]),e}(b);var x=e(3),S=e(11),C=function(t){var n=Object(o.useRef)(null);return Object(o.useEffect)((function(){var e=t.nodeId,a=t.cId,o=t.connector,c=t.onConnectorUpdate;if(n.current){var r=n.current.getContext("2d");if(r&&(!("canvas_ctx"in o.data)||r!==o.data.canvas_ctx))c(e,a,Object(s.a)(o,(function(t){t.data.canvas_ctx=r})))}}),[n,t]),Object(S.jsx)("canvas",{style:{border:"1px solid black"},width:t.connector.data.canvas_width,height:t.connector.data.canvas_height,ref:n})},E=e(26),J=e(95),P=function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(t){var a;return Object(v.a)(this,e),(a=n.call(this,t)).onColorChange=a.onColorChange.bind(Object(E.a)(a)),a}return Object(p.a)(e,[{key:"onColorChange",value:function(t){var n=this.props,e=n.nodeId,a=n.cId,o=n.connector;(0,n.onConnectorUpdate)(e,a,Object(s.a)(o,(function(n){n.data.color="rgba(".concat(t.rgb.r,", ").concat(t.rgb.g,", ").concat(t.rgb.b,", ").concat(t.rgb.a,")")})))}},{key:"render",value:function(){var t=this.props.connector;if(!("color"in t.data)){return Object(S.jsx)(f.b,{message:"'color' connector types must provide a string field named 'color'"})}return Object(S.jsx)(J.a,{color:t.data.color,onChange:this.onColorChange})}}]),e}(o.Component),R=e(96),H=(e(213),function(t){Object(h.a)(e,t);var n=Object(m.a)(e);function e(){return Object(v.a)(this,e),n.apply(this,arguments)}return Object(p.a)(e,[{key:"render",value:function(){return Object(S.jsxs)(S.Fragment,{children:["ICI",Object(S.jsx)(R.a,{onChange:function(t){console.log(t)}})]})}}]),e}(o.Component)),G=H;function M(t){var n=t.connector;return"color"===n.contentType?Object(S.jsx)(P,Object(x.a)({},t)):"slider"===n.contentType?Object(S.jsx)(G,Object(x.a)({},t)):"canvas"===n.contentType?Object(S.jsx)(C,Object(x.a)({},t)):null}var z=function(){var t=c.a.useState(null),n=Object(u.a)(t,2),e=n[0],o=n[1],r=c.a.useState(!1),i=Object(u.a)(r,2),l=i[0],v=i[1],p=c.a.useState({zoom:1,topLeftCorner:{x:0,y:0}}),b=Object(u.a)(p,2),h=b[0],m=b[1],x=c.a.useState([]),C=Object(u.a)(x,2),E=C[0],J=C[1],P=localStorage.getItem("nodes"),R=localStorage.getItem("links"),H=P?JSON.parse(P):{},G=R?JSON.parse(R):{};P&&Object.keys(H).forEach((function(t){H[t]=function(t){var n=void 0;switch(t.name){case a.Canvas:n=y.createFromJson(t);break;case a.Color:n=g.createFromJson(t);break;case a.Number:n=I.createFromJson(t);break;case a.Rectangle:n=j.createFromJson(t);break;case a.Rotate:n=O.createFromJson(t);break;case a.Timer:n=T.createFromJson(t);break;case a.Translate:n=k.createFromJson(t);break;case a.IfElse:n=L.createFromJson(t);break;case a.String:n=N.createFromJson(t);break;case a.Split:n=F.createFromJson(t);break;case a.Operation:n=w.createFromJson(t);break;case a.Log:n=_.createFromJson(t)}if(!n)throw new Error("Error while reading node from json");return n}(H[t])}));var z=c.a.useState(H),B=Object(u.a)(z,2),D=B[0],U=B[1],Z=c.a.useState(G),q=Object(u.a)(Z,2),A=q[0],X=q[1];localStorage.setItem("nodes",JSON.stringify(D)),localStorage.setItem("links",JSON.stringify(A));var Y={0:new y,1:new j,2:new O,3:new I,4:new T,5:new g,6:new k,7:new L,8:new N,9:new F,10:new w,11:new _};c.a.useEffect((function(){Object.keys(D).forEach((function(t){var n=D[t];if(n instanceof y||n instanceof _)try{n.compute(D,A,U)}catch(e){console.error(e)}}))}),[D,A]),c.a.useEffect((function(){var t=setInterval((function(){var t=!1,n=Object(s.c)(D,(function(n){for(var e=0,a=Object.keys(D);e<a.length;e++){var o=a[e];"timer"===n[o].name&&n[o].connectors[1].data.value&&(n[o].connectors[0].data.value=(Number(n[o].connectors[0].data.value)+1).toString(),t=!0)}}));t&&U(n)}),1e3/60);return function(){return clearInterval(t)}}),[D,A]);var K=c.a.useCallback((function(t,n,e,a){U((function(o){return Object(s.c)(o,(function(o){o[t].position={x:n,y:e},o[t].width=a}))}))}),[]),Q=c.a.useCallback((function(t){X((function(n){return Object(s.c)(n,(function(n){n[Object(f.g)()]=t}))}))}),[]),V=c.a.useCallback((function(){var t=E.filter((function(t){return"node"===t.type})).map((function(t){return t.id})),n=E.filter((function(t){return"link"===t.type})).map((function(t){return t.id}));U((function(n){return Object(s.c)(n,(function(n){t.forEach((function(t){delete n[t]}))}))})),X((function(e){return Object(s.c)(e,(function(a){Object.keys(e).forEach((function(n){var o=e[n];(t.includes(o.inputNodeId)||t.includes(o.outputNodeId))&&delete a[n]})),n.forEach((function(t){delete a[t]}))}))}))}),[E]),W=c.a.useCallback((function(t){e&&(U((function(n){return Object(s.c)(n,(function(n){var a=d.a.clone(Y[t]),o=-h.topLeftCorner.x/h.zoom+e.x/h.zoom,c=-h.topLeftCorner.y/h.zoom+e.y/h.zoom;a.position={x:o,y:c},n[Object(f.g)()]=a}))})),v(!1),o(null))}),[h,e,Y]),$=c.a.useCallback((function(t,n,e){U((function(a){return Object(s.c)(a,(function(a){a[t].connectors[n]=e}))}))}),[]),tt=c.a.useCallback((function(t){t.preventDefault(),e?(v(!1),o(null)):o({x:t.pageX,y:t.pageY})}),[e]),nt=c.a.useCallback((function(){e&&!l&&(v(!1),o(null))}),[l,e,o]),et=null;return e&&0===E.length?et=Object(S.jsx)("div",{style:{width:640,height:500,position:"absolute",top:e.y,left:e.x,backgroundColor:"white"},children:Object(S.jsx)(f.a,{nodesSchema:Y,onNodeSelection:W,onMouseHover:v,createCustomConnectorComponent:M})}):e&&(et=Object(S.jsx)("div",{style:{width:640,height:480,position:"absolute",top:e.y,left:e.x,backgroundColor:"white"},children:Object(S.jsx)(f.f,{onMouseHover:v,onDeleteSelection:V})})),Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)("div",{style:{width:"100%",height:"100%"},onContextMenu:tt,onMouseDown:nt,tabIndex:0,children:[Object(S.jsx)(f.c,{panZoomInfo:h,nodes:D,links:A,selectedItems:E,onPanZoomInfo:m,onSelectedItems:J,onNodeMove:K,onCreateLink:Q,onConnectorUpdate:$,createCustomConnectorComponent:M}),et]})})},B=function(){return Object(S.jsx)("div",{style:{width:"100%",height:"100vh"},className:"App",children:Object(S.jsx)(z,{})})};i.a.render(Object(S.jsx)(c.a.StrictMode,{children:Object(S.jsx)(B,{})}),document.getElementById("root"))}},[[214,1,2]]]);
//# sourceMappingURL=main.256a607c.chunk.js.map